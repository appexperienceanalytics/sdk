try{if("undefined"!==typeof BrowserAgent)throw Error("Detected multiple instances of Browser Agent. Skipping monitoring for this instance.");BrowserAgent={};BrowserAgent.globals={init:function(){BrowserAgent.globals.defaultMetricDefs=BrowserAgent.globals.setDefaultMetricDefs();var a={};a.schemaVersion=BrowserAgent.jsonUtils.jsonConstants.SCHEMA_VERSION;a.creator={name:BrowserAgent.jsonUtils.jsonConstants.CREATOR_NAME,version:BrowserAgent.jsonUtils.jsonConstants.CREATOR_VERSION};a.clientInfo={};navigator.userAgent&&
(a.clientInfo.userAgent=navigator.userAgent);BrowserAgent.globals.browserFingerprint&&(a.clientInfo.fingerPrint=BrowserAgent.globals.browserFingerprint);BrowserAgent.globals.platform&&(a.clientInfo.browserType=BrowserAgent.globals.platform);BrowserAgent.globals.platformVersion&&(a.clientInfo.browserMajorVersion=BrowserAgent.globals.platformVersion);a.app={ba:{pages:{pageList:[]}}};BrowserAgent.globals.appInfo.id&&(a.app.id=BrowserAgent.globals.appInfo.id);BrowserAgent.globals.appInfo.key&&(a.app.key=
BrowserAgent.globals.appInfo.key);a.app.version=BrowserAgent.jsonUtils.jsonConstants.APP_VERSION;BrowserAgent.globals.appInfo.tenantId&&(a.app.tenantId=BrowserAgent.globals.appInfo.tenantId);BrowserAgent.globals.profileInfo&&(a.app.profileInfo=BrowserAgent.globals.profileInfo);BrowserAgent.globals.eumJSONShell=a},getSequenceNum:function(){BrowserAgent.globals.sequenceNum+=1;return BrowserAgent.globals.sequenceNum},peekSequenceNum:function(){return BrowserAgent.globals.sequenceNum+1},setDefaultMetricDefs:function(){return{NTAPI_PRT:{name:"Page Render Time",
unit:BrowserAgent.globals.defaultMetricUnits.MILLI,type:BrowserAgent.globals.metricAggregatorType.INT_LONG_DURATION},NTAPI_DPT:{name:"DOM Processing Time",unit:BrowserAgent.globals.defaultMetricUnits.MILLI,type:BrowserAgent.globals.metricAggregatorType.INT_LONG_DURATION},NTAPI_PLT:{name:"Page Load Time",unit:BrowserAgent.globals.defaultMetricUnits.MILLI,type:BrowserAgent.globals.metricAggregatorType.INT_LONG_DURATION},NTAPI_PST:{name:"Page Stall Time",unit:BrowserAgent.globals.defaultMetricUnits.MILLI,
type:BrowserAgent.globals.metricAggregatorType.INT_LONG_DURATION},NTAPI_PPUT:{name:"Previous Page Unload Time",unit:BrowserAgent.globals.defaultMetricUnits.MILLI,type:BrowserAgent.globals.metricAggregatorType.INT_LONG_DURATION},NTAPI_DLT:{name:"Domain Lookup Time",unit:BrowserAgent.globals.defaultMetricUnits.MILLI,type:BrowserAgent.globals.metricAggregatorType.INT_LONG_DURATION},NTAPI_TTFB:{name:"Time to First Byte",unit:BrowserAgent.globals.defaultMetricUnits.MILLI,type:BrowserAgent.globals.metricAggregatorType.INT_LONG_DURATION},
NTAPI_TTLB:{name:"Time to Last Byte",unit:BrowserAgent.globals.defaultMetricUnits.MILLI,type:BrowserAgent.globals.metricAggregatorType.INT_LONG_DURATION},NTAPI_CET:{name:"Connection Establishment Time",unit:BrowserAgent.globals.defaultMetricUnits.MILLI,type:BrowserAgent.globals.metricAggregatorType.INT_LONG_DURATION},PAGE_HPI:{name:"Page Hits Per Interval",unit:BrowserAgent.globals.defaultMetricUnits.NO_UNIT,type:BrowserAgent.globals.metricAggregatorType.LONG_INTERVAL_COUNTER},FUNC_ET:{name:"Execution Time",
unit:BrowserAgent.globals.defaultMetricUnits.MILLI,type:BrowserAgent.globals.metricAggregatorType.INT_LONG_DURATION},FUNC_ICPI:{name:"Invocation Count Per Interval",unit:BrowserAgent.globals.defaultMetricUnits.NO_UNIT,type:BrowserAgent.globals.metricAggregatorType.LONG_INTERVAL_COUNTER},AJAX_RLT:{name:"Resource Load Time",unit:BrowserAgent.globals.defaultMetricUnits.MILLI,type:BrowserAgent.globals.metricAggregatorType.INT_LONG_DURATION},AJAX_TTFB:{name:"Time To First Byte",unit:BrowserAgent.globals.defaultMetricUnits.MILLI,
type:BrowserAgent.globals.metricAggregatorType.INT_LONG_DURATION},AJAX_RDT:{name:"Response Download Time",unit:BrowserAgent.globals.defaultMetricUnits.MILLI,type:BrowserAgent.globals.metricAggregatorType.INT_LONG_DURATION},AJAX_CBET:{name:"Callback Execution Time",unit:BrowserAgent.globals.defaultMetricUnits.MILLI,type:BrowserAgent.globals.metricAggregatorType.INT_LONG_DURATION},AJAX_ICPI:{name:"Invocation Count Per Interval",unit:BrowserAgent.globals.defaultMetricUnits.NO_UNIT,type:BrowserAgent.globals.metricAggregatorType.LONG_INTERVAL_COUNTER},
JSERR_CPI:{name:"JavaScript Errors Per Interval",unit:BrowserAgent.globals.defaultMetricUnits.NO_UNIT,type:BrowserAgent.globals.metricAggregatorType.LONG_INTERVAL_COUNTER},PAGE_UDT:{name:"User Decision Time",unit:BrowserAgent.globals.defaultMetricUnits.MILLI,type:BrowserAgent.globals.metricAggregatorType.INT_LONG_DURATION}}},pageWithEventsMap:{},pageBucketsIdList:[],pageBucketsMap:{},pageBucketsMaxLen:100,evtTypes:{RES:"RES",JSERR:"JSERR",FN:"FN",AXAEXT:"AXAEXT",APMEXT:"APMEXT",HPLOAD:"HPLOAD",SPLOAD:"SPLOAD",
TTIME:"TTIME"},evtHandlers:{},pageBucketTypes:{HP:"HP",SP:"SP"},currPagePtr:null,prevPagePtr:null,currSession:null,currTTimeEvtPtr:null,initPageInfo:null,eumJSONShell:null,softPageLoadEvtObj:null,harvestIntervalId:null,sequenceNum:-1,ajaxDataKeys:{URL:"url",METHOD:"method",STATUS_CODE:"status",RESPONSE_CONTENT_LENGTH:"resSize",REQUEST_BODY_SIZE:"reqSize"},appInfo:null,bs:"-1",bt:"-1",btc:"-1",commaChar:",",configs:null,contentLengthHdrStr:"Content-Length",contentLengthHdrStrLowerCase:"content-length",
appCookies:null,agentCookies:null,agentCookieKeys:"agentCookieKeys",agentCookieKeyName:{AGENTHOST:"AgentHost",SERVLETNAME:"ServletName",USERID:"UserId",AGENTPROCESS:"AgentProcess",AGENTNAME:"AgentName",WEBAPPNAME:"WebAppName"},agentCookiePrefix:"apm",agentCookieKeysRegexPattern:/^apm.+/,CorBrowsGUID:null,defaultBTRegex:/^Default BT( via (Chrome|Edge|Firefox|IE|Safari))?$/,defaultMetricDefs:null,defaultMetricUnits:{NO_UNIT:null,MILLI:"ms"},isSoftPageLoad:!0,domLastUpdated:null,domChangeTimeoutId:null,
domChangeTimerId:null,domChangeObserver:null,domChangeObserverConfig:{childList:!0,characterData:!0,subtree:!0,attributes:!0},softPageDataKeys:{START:"s",END:"e",REFERRER:"r",URL:"url"},emptyObjStr:"{}",forwardSlashChar:"/",functionsToInstrumentList:[],retryFuncIdMap:{},gapTimeInMillis:0,geoConstants:{ERROR:-255,DENIED:-401},geo:{lat:-401,lon:-401},extFuncMap:{},hashChar:"#",isStoragePresent:!0,metricAggregatorType:{INT_LONG_DURATION:0,LONG_INTERVAL_COUNTER:1},metricPathConsts:{PREFIX:"Business Segment",
BROWSER:"Browser",AJAX:"AJAX Call",FUNC:"JavaScript Function",SOFTPAGE:"Soft Page",URL:"URL"},origFuncMap:{},platform:"-1",platformVersion:"-1",pageFullURL:window.location.href,tTimeHandlerFlag:!1,profileURL:"",resourceType:{AJAX:"AJAX"},snippetAttrNames:{SCRIPT_ID:{OLD:"BA_AXA",NEW:"ca_eum_ba"},PROFILE_URL:"data-profileUrl",TENANT_ID:"data-tenantID",APP_ID:"data-appID",APP_KEY:"data-appKey"},timestampNames:{START_TIME:"s",END_TIME:"e",CALLBACK_START_TIME:"cs",CALLBACK_END_TIME:"ce",FIRST_BYTE:"f",
LAST_BYTE:"l",EXTERNAL:"ex"},pipeChar:"|",profileInfo:null,semiColonChar:";",startTime:null,endTime:null,UNDEFINED:"-1",userAgents:{CHROME:{name:"Chrome",ver:30},EDGE:{name:"Edge",ver:12},FIREFOX:{name:"Firefox",ver:30},IE:{name:"IE",ver:11},SAFARI:{name:"Safari",ver:9},UNSUPPORTED:{name:"Unsupported",ver:-1}},browserFingerprint:null,baStartTime:null,trackerDataKey:"TKR",isJQOne:null,isJQ:null,retryInterval:1E3,funcInstrumentMaxRetryCount:10};BrowserAgent.logger={logPrefix:" [CA Browser Agent]: ",
logLevelPrefix:{DEBUG:" [DEBUG] ",ERROR:" [ERROR] ",INFO:" [INFO] ",WARN:" [WARN] "},isOk:function(){return window.console&&"object"===typeof window.console&&(!BrowserAgent.globals.configs||!0===BrowserAgent.globals.configs.BROWSERLOGGINGENABLED)},log:function(a,b){BrowserAgent.logger.isOk()&&window.console.log(new Date+BrowserAgent.logger.logPrefix+a+b)},debug:function(a){BrowserAgent.logger.log(BrowserAgent.logger.logLevelPrefix.DEBUG,a)},error:function(a){BrowserAgent.logger.log(BrowserAgent.logger.logLevelPrefix.ERROR,
a)},info:function(a){BrowserAgent.logger.log(BrowserAgent.logger.logLevelPrefix.INFO,a)},warn:function(a){BrowserAgent.logger.log(BrowserAgent.logger.logLevelPrefix.WARN,a)}};BrowserAgent.browserUtils={UUIDPattern:"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx",UUIDChar:"x",XHRToSendMetrics:null,init:function(){BrowserAgent.globals.configs.GEOENABLED&&this.getGeoLocation();BrowserAgent.globals.browserFingerprint=this.getBrowserFingerprint();BrowserAgent.globals.currSession=this.getSession()},copyObj:function(a,
b){if(!a||"object"!==typeof a)return BrowserAgent.logger.warn("copyObj: Invalid parameters"),null;var c={},d,e=JSON.stringify(a);if(!e||"{}"===e||b)for(e=[],e.push([null,a,c]);0<e.length;){var f=e.shift();if(f[1]&&"object"===typeof f[1])if(f[0])for(d in f[2][f[0]]={},f[1])e.push([d,f[1][d],f[2][f[0]]]);else for(d in f[1])e.push([d,f[1][d],f[2]]);else f[0]?f[2][f[0]]=f[1]:f[2]=f[1]}else c=a;return c},includes:function(a,b){"number"!==typeof b&&(b=0);return b+a.length>this.length?!1:-1!==this.indexOf(a,
b)},getBrowserInfo:function(a){var b=-1;return!a||"string"!==typeof a||/opera|opr/i.test(a)?{name:BrowserAgent.globals.userAgents.UNSUPPORTED.name,ver:BrowserAgent.globals.userAgents.UNSUPPORTED.ver,isSupported:!1}:/edge/i.test(a)&&(b=this.getMajorVersion(a,/(?:edge)\/(\d+(\.\d+)?)/i),b>=BrowserAgent.globals.userAgents.EDGE.ver)?{name:BrowserAgent.globals.userAgents.EDGE.name,ver:b,isSupported:!0}:/msie|trident/i.test(a)&&(b=this.getMajorVersion(a,/(?:msie |rv:)(\d+(\.\d+)?)/i),b>=BrowserAgent.globals.userAgents.IE.ver)?
{name:BrowserAgent.globals.userAgents.IE.name,ver:b,isSupported:!0}:/chrome|crios|crmo/i.test(a)&&(b=this.getMajorVersion(a,/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i),b>=BrowserAgent.globals.userAgents.CHROME.ver)?{name:BrowserAgent.globals.userAgents.CHROME.name,ver:b,isSupported:!0}:/firefox|iceweasel/i.test(a)&&(b=this.getMajorVersion(a,/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i),b>=BrowserAgent.globals.userAgents.FIREFOX.ver)?{name:BrowserAgent.globals.userAgents.FIREFOX.name,ver:b,isSupported:!0}:
/safari/i.test(a)&&(b=this.getMajorVersion(a,/version\/(\d+(\.\d+)?)/i),b>=BrowserAgent.globals.userAgents.SAFARI.ver)?{name:BrowserAgent.globals.userAgents.SAFARI.name,ver:b,isSupported:!0}:{name:BrowserAgent.globals.userAgents.UNSUPPORTED.name,ver:BrowserAgent.globals.userAgents.UNSUPPORTED.ver,isSupported:!1}},getMajorVersion:function(a,b){var c=a.match(b);return c&&1<c.length&&(c=c[1].split("."))&&0<c.length?parseInt(c[0]):0},generateUUID:function(){var a=Date.now();return BrowserAgent.browserUtils.UUIDPattern.replace(/[xy]/g,
function(b){var c=(a+16*Math.random())%16|0;a=Math.floor(a/16);return(b==BrowserAgent.browserUtils.UUIDChar?c:c&3|8).toString(16)})},getBrowserFingerprint:function(){var a=BrowserAgent.storageUtils.getFromStorage(BrowserAgent.storageUtils.storageTypes.LOCAL,BrowserAgent.storageUtils.storageKeys.BAFINGERPRINT);if(a)return BrowserAgent.logger.info("getBrowserFingerprint: Browser Fingerprint already exists."),a;BrowserAgent.logger.info("getBrowserFingerprint: Generating a new Browser Fingerprint...");
a=BrowserAgent.browserUtils.generateUUID();BrowserAgent.storageUtils.putInStorage(BrowserAgent.storageUtils.storageTypes.LOCAL,BrowserAgent.storageUtils.storageKeys.BAFINGERPRINT,a,!1);return a},getSession:function(){var a=BrowserAgent.storageUtils.getFromStorage(BrowserAgent.storageUtils.storageTypes.SESSION,BrowserAgent.storageUtils.storageKeys.BASESSION_ID);if(a){BrowserAgent.logger.info("getSession: Browser Session ID already exists.");if(!BrowserAgent.browserUtils.isSameSession(BrowserAgent.globals.baStartTime))return BrowserAgent.browserUtils.getNewSession(BrowserAgent.globals.baStartTime);
var b={};b.id=a;b.isNewSession=!1;a=BrowserAgent.browserUtils.convertToNum(BrowserAgent.storageUtils.getFromStorage(BrowserAgent.storageUtils.storageTypes.SESSION,BrowserAgent.storageUtils.storageKeys.BASESSION_STARTTIME));null!==a&&(b.startTime=a);return b}return BrowserAgent.browserUtils.getNewSession(BrowserAgent.globals.baStartTime)},getNewSession:function(a){BrowserAgent.logger.info("getNewSession: Generating a new Session ID...");var b=BrowserAgent.browserUtils.generateUUID();BrowserAgent.browserUtils.updateSessionInfo(b,
a,!0);"undefined"!==typeof BrowserAgentExtension&&BrowserAgentExtension.internal.clearAllTrackers();return{id:b,startTime:a,isNewSession:!0}},updateSessionInfo:function(a,b,c){BrowserAgent.storageUtils.putInStorage(BrowserAgent.storageUtils.storageTypes.SESSION,BrowserAgent.storageUtils.storageKeys.BASESSION_ID,a,c);BrowserAgent.storageUtils.putInStorage(BrowserAgent.storageUtils.storageTypes.SESSION,BrowserAgent.storageUtils.storageKeys.BASESSION_STARTTIME,b,c);BrowserAgent.storageUtils.putInStorage(BrowserAgent.storageUtils.storageTypes.SESSION,
BrowserAgent.storageUtils.storageKeys.BALASTEVENT_TIME,b,c)},isSameSession:function(a){if("number"!==typeof a||isNaN(a))return BrowserAgent.logger.error("isSameSession: Cannot determine session truth as event time is NaN."),!0;var b=BrowserAgent.browserUtils.convertToNum(BrowserAgent.storageUtils.getFromStorage(BrowserAgent.storageUtils.storageTypes.SESSION,BrowserAgent.storageUtils.storageKeys.BALASTEVENT_TIME));return null!==b&&a-b>=BrowserAgent.globals.configs.SESSIONTIMEOUT?(BrowserAgent.logger.info("isSameSession: Session timed out due to inactivity."),
!1):!0},hasCustomGeoLocation:function(){return null!==BrowserAgent.storageUtils.getFromStorage(BrowserAgent.storageUtils.storageTypes.SESSION,BrowserAgent.storageUtils.storageKeys.GEOCUSTOM)},getGeoLocation:function(){if(!BrowserAgent.browserUtils.hasCustomGeoLocation())if(navigator&&navigator.geolocation){var a=BrowserAgent.storageUtils.getFromStorage(BrowserAgent.storageUtils.storageTypes.SESSION,BrowserAgent.storageUtils.storageKeys.GEOLAT),b=BrowserAgent.storageUtils.getFromStorage(BrowserAgent.storageUtils.storageTypes.SESSION,
BrowserAgent.storageUtils.storageKeys.GEOLONG);null===a||null===b?(a={timeout:BrowserAgent.globals.configs.GEOTIMEOUT,maximumAge:BrowserAgent.globals.configs.GEOMAXIMUMAGE,enableHighAccuracy:BrowserAgent.globals.configs.GEOHIGHACCURACYENABLED},BrowserAgent.logger.info("getGeoLocation: Attempting to calculate geo location"),navigator.geolocation.getCurrentPosition(this.geoLocationFound,this.geoLocationNotFound,a),setTimeout(function(){null===BrowserAgent.storageUtils.getFromStorage(BrowserAgent.storageUtils.storageTypes.SESSION,
BrowserAgent.storageUtils.storageKeys.GEOLAT)&&(BrowserAgent.logger.warn("getGeoLocation: Never received a response for geo-location. Setting co-ordinates to "+BrowserAgent.globals.geoConstants.DENIED+","+BrowserAgent.globals.geoConstants.DENIED),BrowserAgent.globals.geo.lat=BrowserAgent.globals.geoConstants.DENIED,BrowserAgent.globals.geo.lon=BrowserAgent.globals.geoConstants.DENIED,BrowserAgent.storageUtils.putInStorage(BrowserAgent.storageUtils.storageTypes.SESSION,BrowserAgent.storageUtils.storageKeys.GEOLAT,
BrowserAgent.globals.geoConstants.DENIED,!0),BrowserAgent.storageUtils.putInStorage(BrowserAgent.storageUtils.storageTypes.SESSION,BrowserAgent.storageUtils.storageKeys.GEOLONG,BrowserAgent.globals.geoConstants.DENIED,!0))},parseInt(BrowserAgent.globals.configs.GEOTIMEOUT)+5E3)):(BrowserAgent.globals.geo.lat=Number(a),BrowserAgent.globals.geo.lon=Number(b))}else BrowserAgent.logger.warn("getGeoLocation: Geolocation is not supported in this browser."),BrowserAgent.storageUtils.putInStorage(BrowserAgent.storageUtils.storageTypes.SESSION,
BrowserAgent.storageUtils.storageKeys.GEOLAT,BrowserAgent.globals.geoConstants.ERROR,!0),BrowserAgent.storageUtils.putInStorage(BrowserAgent.storageUtils.storageTypes.SESSION,BrowserAgent.storageUtils.storageKeys.GEOLONG,BrowserAgent.globals.geoConstants.ERROR,!0)},geoLocationFound:function(a){BrowserAgent.browserUtils.hasCustomGeoLocation()||(BrowserAgent.globals.geo.lat=a.coords.latitude,BrowserAgent.globals.geo.lon=a.coords.longitude,BrowserAgent.storageUtils.putInStorage(BrowserAgent.storageUtils.storageTypes.SESSION,
BrowserAgent.storageUtils.storageKeys.GEOLAT,BrowserAgent.globals.geo.lat,!0),BrowserAgent.storageUtils.putInStorage(BrowserAgent.storageUtils.storageTypes.SESSION,BrowserAgent.storageUtils.storageKeys.GEOLONG,BrowserAgent.globals.geo.lon,!0))},geoLocationNotFound:function(a){if(!BrowserAgent.browserUtils.hasCustomGeoLocation()){var b=!1;switch(a.code){case a.PERMISSION_DENIED:BrowserAgent.logger.warn("geoLocationNotFound: Browser indicates that user denied the request for geo-location.");b=!0;break;
case a.POSITION_UNAVAILABLE:BrowserAgent.logger.warn("geoLocationNotFound: Browser's geo-location information is unavailable.");break;case a.TIMEOUT:BrowserAgent.logger.warn("geoLocationNotFound: Browser's request to obtain geo-location timed out.");break;default:BrowserAgent.logger.warn("geoLocationNotFound: An unknown error occurred while browser attempted geo-location.")}b?(BrowserAgent.globals.geo.lat=BrowserAgent.globals.geoConstants.DENIED,BrowserAgent.globals.geo.lon=BrowserAgent.globals.geoConstants.DENIED):
(BrowserAgent.globals.geo.lat=BrowserAgent.globals.geoConstants.ERROR,BrowserAgent.globals.geo.lon=BrowserAgent.globals.geoConstants.ERROR);BrowserAgent.storageUtils.putInStorage(BrowserAgent.storageUtils.storageTypes.SESSION,BrowserAgent.storageUtils.storageKeys.GEOLAT,BrowserAgent.globals.geo.lat,!0);BrowserAgent.storageUtils.putInStorage(BrowserAgent.storageUtils.storageTypes.SESSION,BrowserAgent.storageUtils.storageKeys.GEOLONG,BrowserAgent.globals.geo.lon,!0)}},convertToNum:function(a){if("Number"===
BrowserAgent.browserUtils.getObjType(a)||null===a)return a;a=Number(a);return isNaN(a)?null:a},getObjType:function(a){var b=typeof a;if("object"!==typeof a)return b.charAt(0).toUpperCase()+b.slice(1);try{if(b=Object.prototype.toString.call(a).slice(8,-1),"string"!==typeof b||""===b)return"Object"}catch(c){BrowserAgent.logger.error("getObjType: "+c.message),b=null}return b},cloneTrackerData:function(){var a,b=[],c=JSON.parse(BrowserAgent.storageUtils.getFromStorage(BrowserAgent.storageUtils.storageTypes.SESSION,
BrowserAgent.storageUtils.storageKeys.BATRKR));if(!c)return b;for(var d in c)a=JSON.stringify(c[d]),a!==BrowserAgent.globals.emptyObjStr&&b.push(c[d]);return b},getXHRforBAMetrics:function(){BrowserAgent.globals.origFuncMap&&BrowserAgent.globals.origFuncMap.XHR_ctor&&BrowserAgent.globals.origFuncMap.XHR_ctor_open&&BrowserAgent.globals.origFuncMap.XHR_ctor_send?(BrowserAgent.browserUtils.XHRToSendMetrics=new BrowserAgent.globals.origFuncMap.XHR_ctor,BrowserAgent.browserUtils.XHRToSendMetrics.open=
BrowserAgent.globals.origFuncMap.XHR_ctor_open,BrowserAgent.browserUtils.XHRToSendMetrics.send=BrowserAgent.globals.origFuncMap.XHR_ctor_send):BrowserAgent.browserUtils.XHRToSendMetrics=new XMLHttpRequest},replaceAll:function(a,b,c){return"string"!==typeof a||"string"!==typeof b||"string"!==typeof c?(BrowserAgent.logger.error("replaceAll: Invalid input"),null):a.replace(new RegExp(b,"g"),c)},parseURL:function(a){if("string"!==typeof a||1>a.length)return BrowserAgent.logger.warn("parseURL : Not a valid URL. Skipping parse..."),
null;var b=document.createElement("a");b.href=a;a=b.port;0===a.length&&(a=80,0===b.protocol.indexOf("https")&&(a=443));return{hostname:decodeURIComponent(b.hostname),port:a,pathname:decodeURIComponent(b.pathname),hash:decodeURIComponent(b.hash),href:b.href}},trimURL:function(a){if("string"!==typeof a)return BrowserAgent.logger.error("trimURL: Invalid URL - "+a),null;var b=a.indexOf("?");-1!==b&&(a=a.substring(0,b));b=a.indexOf(BrowserAgent.globals.semiColonChar);a&&-1!==b&&(a=a.substring(0,b));return a},
getFullURL:function(a){if("string"!==typeof a||1>a.length)return BrowserAgent.logger.warn("getFullURL : Not a valid URL. Skipping parse..."),null;var b=document.createElement("a");b.href=a;return b.href},isJQPresent:function(){"undefined"!==typeof jQuery?(BrowserAgent.globals.isJQ=!0,null!==jQuery.fn.jquery.match(/^1\.\d+.*/)?(BrowserAgent.globals.isJQOne=!0,BrowserAgent.logger.info("isJQOnePresent: jQuery 1.x detected.")):BrowserAgent.globals.isJQOne=!1):(BrowserAgent.globals.isJQ=!1,BrowserAgent.globals.isJQOne=
!1)}};BrowserAgent.configUtils={configNames:{BROWSERLOGGINGENABLED:"browserLoggingEnabled",AJAXMETRICSENABLED:"ajaxMetricsEnabled",AJAXMETRICSTHRESHOLD:"ajaxMetricsThreshold",BROWSERAGENTENABLED:"browserAgentEnabled",COLLECTORURL:"collectorUrl",GEOENABLED:"geoEnabled",GEOHIGHACCURACYENABLED:"geoHighAccuracyEnabled",GEOMAXIMUMAGE:"geoMaximumAge",GEOTIMEOUT:"geoTimeout",JSERRORSENABLED:"jsErrorsEnabled",JSFUNCTIONMETRICSENABLED:"jsFunctionMetricsEnabled",JSFUNCTIONMETRICSTHRESHOLD:"jsFunctionMetricsThreshold",
METRICFREQUENCY:"metricFrequency",PAGELOADMETRICSENABLED:"pageLoadMetricsEnabled",PAGELOADMETRICSTHRESHOLD:"pageLoadMetricsThreshold",SESSIONTIMEOUT:"sessionTimeout",URLEXCLUDELIST:"urlExcludeList",URLINCLUDELIST:"urlIncludeList",URLMETRICOFF:"urlMetricOff",DOMCHANGETIMEOUT:"domChangeTimeout",DOMCHANGEINTERVAL:"domChangePollingInterval",COOKIECAPTUREENABLED:"cookieCaptureEnabled"},defaults:{BROWSERLOGGINGENABLED:!1,AJAXMETRICSENABLED:!0,AJAXMETRICSTHRESHOLD:100,BROWSERAGENTENABLED:!1,COLLECTORURL:"",
GEOENABLED:!1,GEOHIGHACCURACYENABLED:!1,GEOMAXIMUMAGE:1E4,GEOTIMEOUT:5E3,JSERRORSENABLED:!0,JSFUNCTIONMETRICSENABLED:!1,JSFUNCTIONMETRICSTHRESHOLD:100,METRICFREQUENCY:3750,PAGELOADMETRICSENABLED:!0,PAGELOADMETRICSTHRESHOLD:100,SESSIONTIMEOUT:36E5,URLEXCLUDELIST:[],URLINCLUDELIST:[],URLMETRICOFF:!1,DOMCHANGETIMEOUT:1E4,DOMCHANGEINTERVAL:100,COOKIECAPTUREENABLED:!1},processAppProfile:function(a){if(!a||!a.baAttributes)return BrowserAgent.logger.error("processAppProfile: Invalid app profile."),!1;for(var b in BrowserAgent.configUtils.configNames){var c=
a.baAttributes[BrowserAgent.configUtils.configNames[b]],d=BrowserAgent.configUtils.defaults[b],e=BrowserAgent.browserUtils.getObjType(c);e===BrowserAgent.browserUtils.getObjType(d)&&("Number"!==e||0<=c)?BrowserAgent.globals.configs[b]=c.valueOf():(BrowserAgent.logger.info("processAppProfile: "+BrowserAgent.configUtils.configNames[b]+" is not provided or invalid. Defaulting to "+JSON.stringify(d)),BrowserAgent.globals.configs[b]=d)}7500<BrowserAgent.globals.configs.METRICFREQUENCY&&(BrowserAgent.logger.warn("processAppProfile: "+
BrowserAgent.configUtils.configNames.METRICFREQUENCY+" is out of range. Defaulting to "+BrowserAgent.configUtils.defaults.METRICFREQUENCY),BrowserAgent.globals.configs.METRICFREQUENCY=BrowserAgent.configUtils.defaults.METRICFREQUENCY);if(50>BrowserAgent.globals.configs.DOMCHANGEINTERVAL||1E3<BrowserAgent.globals.configs.DOMCHANGEINTERVAL)BrowserAgent.logger.warn("processAppProfile: "+BrowserAgent.configUtils.configNames.DOMCHANGEINTERVAL+" is out of range. Defaulting to "+BrowserAgent.configUtils.defaults.DOMCHANGEINTERVAL),
BrowserAgent.globals.configs.DOMCHANGEINTERVAL=BrowserAgent.configUtils.defaults.DOMCHANGEINTERVAL;if(200>BrowserAgent.globals.configs.DOMCHANGETIMEOUT||15E3<BrowserAgent.globals.configs.DOMCHANGETIMEOUT)BrowserAgent.logger.warn("processAppProfile: "+BrowserAgent.configUtils.configNames.DOMCHANGETIMEOUT+" is out of range. Defaulting to "+BrowserAgent.configUtils.defaults.DOMCHANGETIMEOUT),BrowserAgent.globals.configs.DOMCHANGETIMEOUT=BrowserAgent.configUtils.defaults.DOMCHANGETIMEOUT;BrowserAgent.globals.configs.DOMCHANGETIMEOUT<=
BrowserAgent.globals.configs.DOMCHANGEINTERVAL&&(BrowserAgent.logger.warn("processAppProfile: "+BrowserAgent.configUtils.configNames.DOMCHANGETIMEOUT+" cannot be less than or equal to "+BrowserAgent.configUtils.configNames.DOMCHANGEINTERVAL+". Using default values."),BrowserAgent.globals.configs.DOMCHANGEINTERVAL=BrowserAgent.configUtils.defaults.DOMCHANGEINTERVAL,BrowserAgent.globals.configs.DOMCHANGETIMEOUT=BrowserAgent.configUtils.defaults.DOMCHANGETIMEOUT);BrowserAgent.globals.profileInfo=BrowserAgent.configUtils.extractProfileInfo(a);
return!0},getAppProfile:function(a){BrowserAgent.browserUtils.getXHRforBAMetrics();var b=BrowserAgent.browserUtils.XHRToSendMetrics;b&&(b.open("GET",a,!0),b.onreadystatechange=function(){if(this.readyState===this.DONE&&200===this.status){var a=null;try{a=JSON.parse(b.responseText)}catch(d){BrowserAgent.logger.error("getAppProfile: Invalid app profile - "+d.message+". Disabling Browser Agent...");BrowserAgent.configUtils.disableBA();return}BrowserAgent.logger.info("getAppProfile: Successfully obtained new app profile.");
BrowserAgent.configUtils.updateAppProfile(a)}},b.send())},extractAppInfo:function(){var a=document.querySelector(BrowserAgent.globals.hashChar+BrowserAgent.globals.snippetAttrNames.SCRIPT_ID.NEW+BrowserAgent.globals.commaChar+BrowserAgent.globals.hashChar+BrowserAgent.globals.snippetAttrNames.SCRIPT_ID.OLD);if(!a)return BrowserAgent.logger.error("extractAppInfo: Snippet is not found. App information could not be extracted."),!1;var b=a.getAttribute(BrowserAgent.globals.snippetAttrNames.PROFILE_URL);
if("string"!==typeof b||""===b)return BrowserAgent.logger.error("extractAppInfo: Unable to obtain profile URL."),!1;BrowserAgent.globals.profileURL=b;var b=a.getAttribute(BrowserAgent.globals.snippetAttrNames.APP_ID),c=a.getAttribute(BrowserAgent.globals.snippetAttrNames.APP_KEY),a=a.getAttribute(BrowserAgent.globals.snippetAttrNames.TENANT_ID);if("string"!==typeof b||""===b||"string"!==typeof c||""===c||"string"!==typeof a||""===a)return BrowserAgent.logger.error("extractAppInfo: Unable to obtain App specific information."),
!1;BrowserAgent.globals.appInfo={id:b,key:c,tenantId:a};return!0},updateAppProfile:function(a){var b=BrowserAgent.globals.configs.METRICFREQUENCY,c=BrowserAgent.globals.configs.JSERRORSENABLED,d=BrowserAgent.globals.configs.PAGELOADMETRICSENABLED;BrowserAgent.configUtils.processAppProfile(a)?!1===BrowserAgent.globals.configs.BROWSERAGENTENABLED?(BrowserAgent.logger.info("updateAppProfile: Browser Agent is DISABLED."),BrowserAgent.configUtils.disableBA()):"string"!==typeof BrowserAgent.globals.configs.COLLECTORURL||
""===BrowserAgent.globals.configs.COLLECTORURL?(BrowserAgent.logger.warn("updateAppProfile: Invalid collector url. Disabling Browser Agent..."),BrowserAgent.configUtils.disableBA()):(a=BrowserAgent.configUtils.isUrlExcluded(window.location.href),BrowserAgent.globals.currPagePtr.isExcluded!==a&&!0===a&&BrowserAgent.logger.info("updateAppProfile: Page ["+window.location.href+"] is configured to be EXCLUDED. Skipping all instrumentation on this page..."),BrowserAgent.globals.currPagePtr.isExcluded=a,
d!==BrowserAgent.globals.configs.PAGELOADMETRICSENABLED&&(!0===BrowserAgent.globals.configs.PAGELOADMETRICSENABLED?window.MutationObserver&&window.history&&(BrowserAgent.globals.isSoftPageLoad=!0):BrowserAgent.pageUtils.disableSoftPages()),c!==BrowserAgent.globals.configs.JSERRORSENABLED&&(!1===BrowserAgent.globals.configs.JSERRORSENABLED?(BrowserAgent.logger.info("updateAppProfile: JS Error Monitoring is DISABLED. Detaching from window.onerror event..."),window.removeEventListener("error",BrowserAgent.errorUtils.captureJSError)):
BrowserAgent.errorUtils.init()),!0===BrowserAgent.globals.configs.GEOENABLED?BrowserAgent.browserUtils.getGeoLocation():(BrowserAgent.globals.geo.lat=BrowserAgent.globals.geoConstants.ERROR,BrowserAgent.globals.geo.lon=BrowserAgent.globals.geoConstants.ERROR,delete BrowserAgent.globals.eumJSONShell.clientInfo.geolocation),b!==BrowserAgent.globals.configs.METRICFREQUENCY&&BrowserAgent.globals.harvestIntervalId&&(clearInterval(BrowserAgent.globals.harvestIntervalId),BrowserAgent.globals.harvestIntervalId=
setInterval(BrowserAgent.evtUtils.harvestEvts,BrowserAgent.globals.configs.METRICFREQUENCY))):BrowserAgent.logger.info("updateAppProfile: Using existing app profile.")},extractProfileInfo:function(a){if(!a)return null;var b={},c=!1;a.profileId&&(b.id=a.profileId,c=!0);a.profileName&&(b.name=a.profileName,c=!0);a.created&&(b.createdAt=a.created,c=!0);a.lastUpdated&&(b.lastUpdatedAt=a.lastUpdated,c=!0);return c?b:null},disableBA:function(){BrowserAgent.globals.harvestIntervalId&&(clearInterval(BrowserAgent.globals.harvestIntervalId),
BrowserAgent.globals.harvestIntervalId=null);BrowserAgent.globals.pageWithEventsMap={};BrowserAgent.globals.pageBucketsMap={};BrowserAgent.globals.pageBucketsIdList=[];BrowserAgent.globals.currTTimeEvtPtr=null;BrowserAgent.globals.currPagePtr=null;for(var a in BrowserAgent.globals.retryFuncIdMap)clearTimeout(BrowserAgent.globals.retryFuncIdMap[a]);window.removeEventListener("error",BrowserAgent.errorUtils.captureJSError);window.removeEventListener("beforeunload",BrowserAgent.pageUtils.tTimeHandler,
!0);window.removeEventListener("pagehide",BrowserAgent.pageUtils.tTimeHandler,!0);BrowserAgent.pageUtils.disableSoftPages();BrowserAgent.globals.configs.BROWSERAGENTENABLED=!1;BrowserAgent.globals.configs.JSERRORSENABLED=!1;BrowserAgent.globals.configs.PAGELOADMETRICSENABLED=!1;BrowserAgent.globals.configs.AJAXMETRICSENABLED=!1;BrowserAgent.globals.configs.JSFUNCTIONMETRICSENABLED=!1;BrowserAgent.globals.configs.GEOENABLED=!1;BrowserAgent.globals.configs.BROWSERLOGGINGENABLED=!1},isUrlExcluded:function(a){if("string"!==
typeof a||1>a.length)return BrowserAgent.logger.warn("isUrlExcluded: Invalid URL. Skipping URL exclusion check..."),!1;var b=BrowserAgent.globals.configs.URLINCLUDELIST,c=BrowserAgent.globals.configs.URLEXCLUDELIST;return 0<c.length&&BrowserAgent.configUtils.isUrlInRegexList(a,c)||0<b.length&&!BrowserAgent.configUtils.isUrlInRegexList(a,b)},isUrlInRegexList:function(a,b){for(var c=0;c<b.length;c++)if((new RegExp(b[c])).test(a))return!0;return!1}};BrowserAgent.storageUtils={storageTypes:{SESSION:0,
LOCAL:1},storageKeys:{GEOLAT:"BALat",GEOLONG:"BALong",GEOCUSTOM:"BAGEOCustom",BAFINGERPRINT:"BAFinPrt",BASESSION_ID:"BASSID",BASESSION_STARTTIME:"BASSSTART",BALASTEVENT_TIME:"BALASTEVT",PATHNAME:window.location.pathname,BATRKR:"BATRKR"},init:function(){try{sessionStorage.setItem("BATEST","test"),sessionStorage.removeItem("BATEST"),localStorage.setItem("BATEST","test"),localStorage.removeItem("BATEST")}catch(a){BrowserAgent.logger.warn("storageUtils.init: Access to browser storage is denied. Browser Agent may exhibit unexpected behavior."),
BrowserAgent.globals.isStoragePresent=!1}},putInStorage:function(a,b,c,d){try{if(BrowserAgent.globals.isStoragePresent)if("string"!==typeof b||null===c||void 0===c||"boolean"!==typeof d)BrowserAgent.logger.warn("putInStorage: Invalid input.");else switch(a){case BrowserAgent.storageUtils.storageTypes.SESSION:(d||!d&&null===sessionStorage.getItem(b))&&sessionStorage.setItem(b,c);break;case BrowserAgent.storageUtils.storageTypes.LOCAL:(d||!d&&null===localStorage.getItem(b))&&localStorage.setItem(b,
c)}}catch(e){BrowserAgent.logger.error("putInStorage: "+e.message)}},getFromStorage:function(a,b){try{if(!BrowserAgent.globals.isStoragePresent)return null;if("string"!==typeof b)return BrowserAgent.logger.warn("getFromStorage: Invalid input."),null;switch(a){case BrowserAgent.storageUtils.storageTypes.SESSION:return sessionStorage.getItem(b);case BrowserAgent.storageUtils.storageTypes.LOCAL:return localStorage.getItem(b);default:return null}}catch(c){return BrowserAgent.logger.error("getFromStorage: "+
c.message),null}}};BrowserAgent.cookieUtils={cookies:{BTRESP:"x-apm-brtm-response-bt",BTRESPID:"x-apm-brtm-response-bt-id",BTPAGERESP:"x-apm-brtm-response-bt-page",SERVERTIME:"x-apm-brtm-servertime",GAPTIME:"x-apm-brtm-gaptime",PLATFORM:"x-apm-brtm-bt-p",PLATFORMVER:"x-apm-brtm-bt-pv"},cookieKeys:{apmStartTimeChar:"startTime",apmEndTimeChar:"endTime",bsChar:"bs",btChar:"bt",btcChar:"btc",CorBrowsGUIDChar:"CorBrowsGUID",geoChar:"g",platformChar:"p",platformVerChar:"pv"},baCookieRegex:/^x-apm-brtm-.*|^WMRUMC.*/,
init:function(){var a=BrowserAgent.cookieUtils.cookies.BTPAGERESP+"-"+encodeURIComponent(window.location.pathname),b=BrowserAgent.cookieUtils.getRawCookie(a);BrowserAgent.cookieUtils.deleteCookie(a,"/",null);b?BrowserAgent.cookieUtils.updateHPDataObjWithCookieData(BrowserAgent.cookieUtils.tokenizeCookieIntoMap(b,",")):BrowserAgent.logger.warn("cookieUtils.init: Cannot get page bt cookie for url \x3d "+window.location.pathname);BrowserAgent.cookieUtils.deleteCookie(BrowserAgent.cookieUtils.cookies.SERVERTIME,
"/",null);BrowserAgent.globals.platform=BrowserAgent.cookieUtils.getRawCookie(BrowserAgent.cookieUtils.cookies.PLATFORM);BrowserAgent.globals.platformVersion=BrowserAgent.cookieUtils.getRawCookie(BrowserAgent.cookieUtils.cookies.PLATFORMVER)},deleteCookie:function(a,b,c){a?document.cookie=a+"\x3d; expires\x3dThu, 01-Jan-1970 00:00:01 GMT"+(c?"; domain\x3d"+c:"")+(b?"; path\x3d"+b:""):BrowserAgent.logger.warn("deleteCookie : Cannot delete cookie by name "+a)},getRawCookie:function(a){if(!a)return BrowserAgent.logger.warn("getRawCookie : Cannot obtain cookie "+
a),null;if(0<document.cookie.length){var b=document.cookie.indexOf(a+"\x3d");if(-1!==b)return b=b+a.length+1,a=document.cookie.indexOf(";",b),-1===a&&(a=document.cookie.length),decodeURIComponent(BrowserAgent.browserUtils.replaceAll(document.cookie.substring(b,a),"\\+","%20"))}return null},tokenizeCookieIntoMap:function(a,b){var c={};if(!a||!b)return BrowserAgent.logger.warn("tokenizeCookieIntoMap : Cannot parse "+a+" by "+b),c;a=a.replace(/["]/g,"");for(var d=a.split(b),e,f,g=0;g<d.length;g++)e=
d[g].split("\x3d"),2===e.length?c[e[0]]=e[1]:2<e.length&&(f=d[g].indexOf("\x3d"),c[e[0]]=d[g].substring(f+1));return c},setRawCookie:function(a,b,c,d,e){if(a){var f=new Date(Date.now()+1E3*c);document.cookie=a+"\x3d"+encodeURIComponent(b)+(c?"; expires\x3d"+f.toUTCString():"")+(e?"; domain\x3d"+e:"")+(d?"; path\x3d"+d:"")}else BrowserAgent.logger.warn("setRawCookie : Cannot set cookie with name "+a)},updateCookie:function(a,b){if(a){var c=JSON.parse(this.getRawCookie(a)),d={},e;for(e in c)d[e]=c[e];
if("object"===typeof b)for(var f in b)null!==b[f]?d[f]=b[f]:delete d[f];else d=b;this.setRawCookie(a,JSON.stringify(d),null,"/",null)}else BrowserAgent.logger.warn("updateCookie: Cannot update cookie with name "+a)},updateResDataObjWithCookieData:function(a,b){if(a&&b&&"object"===typeof a&&"object"===typeof b){var c,d;for(d in BrowserAgent.cookieUtils.cookieKeys)c=BrowserAgent.cookieUtils.cookieKeys[d],a[c]&&(b[c]=a[c],delete a[c]);c=BrowserAgent.globals.agentCookieKeys;for(d in a)BrowserAgent.globals.agentCookieKeysRegexPattern.test(d)&&
(b[c]||(b[c]={}),b[c][d]=a[d]);BrowserAgent.globals.defaultBTRegex.test(b.bt)&&(b.bs=BrowserAgent.globals.UNDEFINED,b.bt=BrowserAgent.globals.UNDEFINED,b.btc=BrowserAgent.globals.UNDEFINED)}else BrowserAgent.logger.warn("updateResDataObjWithCookieData: Cannot update object with data from cookie")},updateHPDataObjWithCookieData:function(a){if(a&&"object"===typeof a){var b,c;for(c in BrowserAgent.cookieUtils.cookieKeys)b=BrowserAgent.cookieUtils.cookieKeys[c],a[b]&&(BrowserAgent.globals[b]=a[b],delete a[b]);
for(c in a)BrowserAgent.globals.agentCookieKeysRegexPattern.test(c)&&(BrowserAgent.globals.agentCookies||(BrowserAgent.globals.agentCookies={}),BrowserAgent.globals.agentCookies[c]=a[c]);BrowserAgent.globals.defaultBTRegex.test(BrowserAgent.globals.bt)&&(BrowserAgent.globals.bs=BrowserAgent.globals.UNDEFINED,BrowserAgent.globals.bt=BrowserAgent.globals.UNDEFINED,BrowserAgent.globals.btc=BrowserAgent.globals.UNDEFINED)}else BrowserAgent.logger.warn("updateHPDataObjWithCookieData: Cannot update object with data from cookie")},
isCookieEnabled:function(){var a=navigator.cookieEnabled?!0:!1;!0!==navigator.cookieEnabled&&(document.cookie="baTestCookie",a=-1!==document.cookie.indexOf("baTestCookie")?!0:!1);return a},getAppCookies:function(){if(!BrowserAgent.cookieUtils.isCookieEnabled())return BrowserAgent.logger.warn("getAppCookies: Cannot obtain cookie snapshot because cookies are disabled."),null;var a,b={},c;if(1>document.cookie.length)return b;c=document.cookie.split("; ");for(var d=0;d<c.length;d++)a=c[d].split("\x3d"),
BrowserAgent.cookieUtils.baCookieRegex.test(a[0])||(b[a[0]]=c[d].substring(a[0].length+1));return b}};BrowserAgent.errorUtils={errorKey:"jsError",errorType:{CLIENT:"CLIENT",NETWORK:"NETWORK",SUBTYPE:{EVAL:"EvalError",INT:"InternalError",RNG:"RangeError",REF:"ReferenceError",SYN:"SyntaxError",TYP:"TypeError",URI:"URIError"}},errorDataFields:{TYP:"ErrType",SUB:"SubType",MSG:"Msg",SRC:"File",LIN:"Line",COL:"Col",STK:"Stack",STT:"StartTime",DUR:"Duration"},init:function(){!1===BrowserAgent.globals.configs.JSERRORSENABLED?
BrowserAgent.logger.info("errorUtils.init: JS Error Monitoring is DISABLED."):(BrowserAgent.logger.info("errorUtils.init: Attaching to window.onerror event..."),window.addEventListener("error",BrowserAgent.errorUtils.captureJSError))},captureJSError:function(a){try{if(a){var b=BrowserAgent.evtUtils.getEvtObject(BrowserAgent.globals.evtTypes.JSERR,!0,BrowserAgent.errorUtils.errorDataFields.STT);if(b){var c=null,d=null;a.error?(c=a.error.stack,d=BrowserAgent.errorUtils.getSubType(a.error.name,a.message)):
(BrowserAgent.logger.warn("captureJSError : Stack information is unavailable from error object"),d=BrowserAgent.errorUtils.getSubType(null,a.message));b[BrowserAgent.errorUtils.errorDataFields.TYP]=BrowserAgent.errorUtils.errorType.CLIENT;b[BrowserAgent.errorUtils.errorDataFields.SUB]=d;b[BrowserAgent.errorUtils.errorDataFields.MSG]=a.message;b[BrowserAgent.errorUtils.errorDataFields.SRC]=a.filename;b[BrowserAgent.errorUtils.errorDataFields.LIN]=a.lineno;b[BrowserAgent.errorUtils.errorDataFields.COL]=
a.colno;b[BrowserAgent.errorUtils.errorDataFields.STK]=c;b.isDone=!0}}else BrowserAgent.logger.warn("captureJSError: Could not capture error. Error object is unavailable.")}catch(e){b&&(b.isDelete=!0),BrowserAgent.logger.error("captureJSError: Could not capture JS error due to "+e.message)}},getSubType:function(a,b){if("string"!==typeof a){if("string"!==typeof b)return BrowserAgent.logger.warn("getSubType: Could not obtain error subtype"),null;var c=b.split(":");return 2>c.length?null:c[0]}return a}};
BrowserAgent.funcUtils={tracers:{xhrOpenPre:function(){try{this._BAState||(this._BAState={},this._BAState.xhrOpenPre={});var a=arguments[arguments.length-1];this._BAState.xhrOpenPre.isError=!1;this._BAState.xhrOpenPre._isAjaxInstrumented=!0;if(BrowserAgent.globals.currPagePtr.isExcluded)this._BAState.xhrOpenPre._isAjaxInstrumented=!1;else if(this._BAState.xhrOpenPre._httpMethod=a.invocationData[0],this._BAState.xhrOpenPre._url=a.invocationData[1],this._BAState.xhrOpenPre._fullURL=BrowserAgent.browserUtils.getFullURL(this._BAState.xhrOpenPre._url),
this._BAState.xhrOpenPre._async=!0,3<=arguments.length&&(this._BAState.xhrOpenPre._async=a.invocationData[2]),this._BAState.xhrOpenPre.isAjaxEnabled=BrowserAgent.globals.configs.AJAXMETRICSENABLED,this._BAState.xhrOpenPre.isAjaxExcluded=BrowserAgent.configUtils.isUrlExcluded(this._BAState.xhrOpenPre._fullURL),this._BAState.xhrOpenPre.isAjaxEnabled||BrowserAgent.logger.info("xhrOpenPre: AJAX Metrics are DISABLED."),this._BAState.xhrOpenPre.isAjaxExcluded&&BrowserAgent.logger.info("xhrOpenPre: AJAX URL ["+
this._BAState.xhrOpenPre._fullURL+"] is configured to be EXCLUDED."),!this._BAState.xhrOpenPre.isAjaxEnabled||this._BAState.xhrOpenPre.isAjaxExcluded)this._BAState.xhrOpenPre._isAjaxInstrumented=!1}catch(b){this._BAState.xhrOpenPre.isError=!0,BrowserAgent.logger.error("xhrOpenPre ("+this._BAState.origFunctionName+"): "+b.message)}},xhrOrscPre:function(){this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.ajaxDataKeys.URL]=this._BAState.xhrOpenPre._fullURL;this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.ajaxDataKeys.METHOD]=
this._BAState.xhrOpenPre._httpMethod;this._BAState.xhrSendPre.contentLen=BrowserAgent.funcUtils.calculateAjaxResponseSize(this);"number"===typeof this._BAState.xhrSendPre.contentLen&&(this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.ajaxDataKeys.RESPONSE_CONTENT_LENGTH]=this._BAState.xhrSendPre.contentLen);this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.timestampNames.FIRST_BYTE]||this._BAState.xhrSendPre.contentLen||(this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.timestampNames.FIRST_BYTE]=
this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.timestampNames.LAST_BYTE]);this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.ajaxDataKeys.STATUS_CODE]=this.status;var a=BrowserAgent.cookieUtils.getRawCookie(BrowserAgent.cookieUtils.cookies.BTRESP+"-"+this._BAState.xhrSendPre.evtObj.id);a&&(a=BrowserAgent.cookieUtils.tokenizeCookieIntoMap(a,","),BrowserAgent.cookieUtils.updateResDataObjWithCookieData(a,this._BAState.xhrSendPre.evtObj));BrowserAgent.cookieUtils.deleteCookie(BrowserAgent.cookieUtils.cookies.BTRESP+
"-"+this._BAState.xhrSendPre.evtObj.id,"/",null)},xhrSendPre:function(a){this._BAState.xhrSendPre||(this._BAState.xhrSendPre={});this._BAState.xhrSendPre.isError=!1;this._BAState.xhrSendPre.contentLen=null;try{if(!this._BAState.xhrOpenPre.isError&&this._BAState.xhrOpenPre._isAjaxInstrumented&&this._BAState.xhrOpenPre._async){this._BAState.xhrSendPre.evtObj=BrowserAgent.evtUtils.getEvtObject(BrowserAgent.globals.evtTypes.RES,!1,null);this._BAState.xhrSendPre.evtObj||(this._BAState.xhrSendPre.isError=
!0);BrowserAgent.cookieUtils.setRawCookie(BrowserAgent.cookieUtils.cookies.BTRESPID,this._BAState.xhrSendPre.evtObj.id,2,"/",null);this._BAState.xhrSendPre.bodySize=BrowserAgent.funcUtils.calculateAjaxRequestSize(a);!this._BAState.xhrSendPre.isError&&this._BAState.xhrSendPre.bodySize&&(this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.ajaxDataKeys.REQUEST_BODY_SIZE]=this._BAState.xhrSendPre.bodySize);var b=this.onloadend,c=this.onreadystatechange,d=this.onload;this.onload=function(){var a;if(d){try{var b=
Date.now();this._BAState.xhrSendPre.isError||(BrowserAgent.globals.isJQOne&&!this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.ajaxDataKeys.URL]?(BrowserAgent.funcUtils.tracers.xhrOrscPre.apply(this,arguments),d._origFlag&&!this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.timestampNames.CALLBACK_START_TIME]&&(this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.timestampNames.CALLBACK_START_TIME]=b)):this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.timestampNames.CALLBACK_START_TIME]||
(this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.timestampNames.CALLBACK_START_TIME]=b))}catch(c){this._BAState.xhrSendPre.isError=!0,BrowserAgent.logger.error("xhrSendPre - onload pre ("+this._BAState.xhrOpenPre._fullURL+"): "+c.message)}a=d.apply(this,arguments)}return a};this.onloadend=function(){var a;if(b){try{this._BAState.xhrSendPre.isError||this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.timestampNames.CALLBACK_START_TIME]||(this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.timestampNames.CALLBACK_START_TIME]=
Date.now())}catch(c){this._BAState.xhrSendPre.isError=!0,this._BAState.xhrSendPre.evtObj&&(this._BAState.xhrSendPre.evtObj.isDelete=!0),BrowserAgent.logger.error("xhrSendPre - onloadend pre ("+this._BAState.xhrOpenPre._fullURL+"): "+c.message)}a=b.apply(this,arguments)}try{this._BAState.xhrSendPre.isError||this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.timestampNames.CALLBACK_END_TIME]||(this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.timestampNames.CALLBACK_END_TIME]=Date.now())}catch(d){this._BAState.xhrSendPre.isError=
!0,this._BAState.xhrSendPre.evtObj&&(this._BAState.xhrSendPre.evtObj.isDelete=!0),BrowserAgent.logger.error("xhrSendPre - onloadend post ("+this._BAState.xhrOpenPre._fullURL+"): "+d.message)}this._BAState.xhrSendPre.evtObj.isDone=!0;return a};this.onreadystatechange=function(){var a;try{this._BAState.xhrSendPre.isError||(this.readyState===this.LOADING&&(this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.timestampNames.FIRST_BYTE]=Date.now()),this.readyState===this.DONE&&(this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.timestampNames.LAST_BYTE]=
Date.now(),BrowserAgent.funcUtils.tracers.xhrOrscPre.apply(this,arguments)))}catch(b){this._BAState.xhrSendPre.isError=!0,this._BAState.xhrSendPre.evtObj&&(this._BAState.xhrSendPre.evtObj.isDelete=!0),BrowserAgent.logger.error("xhrSendPre - orsc pre - 1 ("+this._BAState.xhrOpenPre._fullURL+"): "+b.message)}if(c){try{this._BAState.xhrSendPre.isError||this.readyState!==this.DONE||this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.timestampNames.CALLBACK_START_TIME]||(this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.timestampNames.CALLBACK_START_TIME]=
Date.now())}catch(d){this._BAState.xhrSendPre.isError=!0,BrowserAgent.logger.error("xhrSendPre - orsc pre - 2 ("+this._BAState.xhrOpenPre._fullURL+"): "+d.message)}a=c.apply(this,arguments)}return a}}}catch(e){this._BAState.xhrSendPre.isError=!0,this._BAState.xhrSendPre.evtObj&&(this._BAState.xhrSendPre.evtObj.isDelete=!0),BrowserAgent.logger.error("xhrSendPre ("+this._BAState.xhrOpenPre._fullURL+"): "+e.message)}},xhrSendPost:function(){try{!this._BAState.xhrSendPre.isError&&this._BAState.xhrOpenPre._isAjaxInstrumented&&
this._BAState.xhrOpenPre._async&&(this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.timestampNames.END_TIME]=Date.now(),this._BAState.xhrSendPre.evtObj[BrowserAgent.globals.trackerDataKey]=BrowserAgent.browserUtils.cloneTrackerData())}catch(a){this._BAState.xhrSendPre.evtObj&&(this._BAState.xhrSendPre.evtObj.isDelete=!0),BrowserAgent.logger.error("xhrSendPost ("+this._BAState.xhrOpenPre._fullURL+"): "+a.message)}},JSFuncPre:function(){var a=arguments[arguments.length-1];try{a.JSFuncPre||(a.JSFuncPre=
{}),a.JSFuncPre.isError=!1,a.JSFuncPre.isFuncEnabled=BrowserAgent.globals.configs.JSFUNCTIONMETRICSENABLED,a.JSFuncPre.isFuncEnabled?(a.JSFuncPre.evtObj=BrowserAgent.evtUtils.getEvtObject(BrowserAgent.globals.evtTypes.FN,!1,BrowserAgent.globals.timestampNames.START_TIME),a.JSFuncPre.evtObj||(a.JSFuncPre.isError=!0)):BrowserAgent.logger.info("JSFuncPre ("+a.origFunctionName+"): JS Function Metrics are DISABLED.")}catch(b){a.JSFuncPre.isError=!0,a.JSFuncPre.evtObj&&(a.JSFuncPre.evtObj.isDelete=!0),
BrowserAgent.logger.error("JSFuncPre ("+a.origFunctionName+"): "+b.message)}},JSFuncPost:function(){var a=arguments[arguments.length-1];try{!a.JSFuncPre.isError&&a.JSFuncPre.isFuncEnabled&&(a.JSFuncPre.evtObj[BrowserAgent.globals.trackerDataKey]=BrowserAgent.browserUtils.cloneTrackerData(),a.JSFuncPre.evtObj[BrowserAgent.globals.timestampNames.END_TIME]=Date.now(),a.JSFuncPre.evtObj.fnName=a.origFunctionName,a.JSFuncPre.evtObj.isDone=!0)}catch(b){a.JSFuncPre.evtObj&&(a.JSFuncPre.evtObj.isDelete=!0),
BrowserAgent.logger.error("JSFuncPost ("+a.origFunctionName+"): "+b.message)}},routeChangePre:function(){var a=arguments[arguments.length-1];try{if(BrowserAgent.globals.configs.PAGELOADMETRICSENABLED){if(a.routeChangePre||(a.routeChangePre={}),a.routeChangePre[BrowserAgent.globals.softPageDataKeys.START]=Date.now(),a.routeChangePre[BrowserAgent.globals.trackerDataKey]=BrowserAgent.browserUtils.cloneTrackerData(),a.routeChangePre.isError=!1,BrowserAgent.globals.domChangeTimeoutId||BrowserAgent.globals.domChangeTimerId)BrowserAgent.logger.debug(a.origFunctionName+
" routeChangePre: DOM change tracking terminated by new route change."),BrowserAgent.pageUtils.endDomTracking(a.routeChangePre[BrowserAgent.globals.softPageDataKeys.START])}else BrowserAgent.logger.info("routeChangePre: Soft Page Metrics are DISABLED.")}catch(b){a.routeChangePre.isError=!0,BrowserAgent.logger.error("routeChangePre ("+a.origFunctionName+"): "+b.message)}},routeChangePost:function(){var a=arguments[arguments.length-1];try{BrowserAgent.pageUtils.addNewPageBucket(BrowserAgent.globals.pageBucketTypes.SP,
window.location.href,a.routeChangePre[BrowserAgent.globals.softPageDataKeys.START],!0,a.routeChangePre[BrowserAgent.globals.trackerDataKey]),BrowserAgent.globals.isSoftPageLoad&&(a.routeChangePre.isError||BrowserAgent.pageUtils.startDomTracking(a.routeChangePre[BrowserAgent.globals.softPageDataKeys.START],a.routeChangePre[BrowserAgent.globals.trackerDataKey]))}catch(b){BrowserAgent.logger.error("routeChangePost ("+a.origFunctionName+"): "+b.message)}},"jQuery.ajaxSettings.xhrPost":function(){var a=
arguments[arguments.length-1];try{if(!1!==BrowserAgent.globals.isJQ){a.jQXhrPost||(a.jQXhrPost={});"boolean"!==typeof BrowserAgent.globals.isJQ&&BrowserAgent.browserUtils.isJQPresent();if(!0===BrowserAgent.globals.isJQOne){var b=a.funcRetVal,c=b.onload;b.onload=function(){c&&(c._origFlag=!0,c.apply(this,arguments))}}!0!==a.jQXhrPost.isVisited&&($.ajaxPrefilter(function(b,c,d){b._evtInfo={};b._evtInfo.evtId=BrowserAgent.globals.peekSequenceNum();b._evtInfo.pageId=BrowserAgent.globals.currPagePtr.id;
var h=c.success,k=c.complete,l;h&&(b.success=function(b,c,d){var e;try{(e=BrowserAgent.globals.pageBucketsMap[this._evtInfo.pageId].evtMap[this._evtInfo.evtId])&&(e[BrowserAgent.globals.timestampNames.CALLBACK_START_TIME]=Date.now())}catch(f){a.jQXhrPost.isError=!0,BrowserAgent.logger.error("jQuery.ajaxSettings.xhrPost - Success Pre ("+a.origFunctionName+"): "+f.message)}l=h.apply(this,arguments);try{!a.jQXhrPost.isError&&e&&(e[BrowserAgent.globals.timestampNames.CALLBACK_END_TIME]=Date.now())}catch(g){a.jQXhrPost.isError=
!0,BrowserAgent.logger.error("jQuery.ajaxSettings.xhrPost - Success Post ("+a.origFunctionName+"): "+g.message)}return l});k&&(b.complete=function(b,c){var d,e;try{d=BrowserAgent.globals.pageBucketsMap[this._evtInfo.pageId].evtMap[this._evtInfo.evtId],a.jQXhrPost.isError||!d||d[BrowserAgent.globals.timestampNames.CALLBACK_START_TIME]||(d[BrowserAgent.globals.timestampNames.CALLBACK_START_TIME]=Date.now())}catch(f){a.jQXhrPost.isError=!0,BrowserAgent.logger.error("jQuery.ajaxSettings.xhrPost - Complete Pre ("+
a.origFunctionName+"): "+f.message)}e=k.apply(this,arguments);try{!a.jQXhrPost.isError&&d&&(d[BrowserAgent.globals.timestampNames.CALLBACK_END_TIME]=Date.now())}catch(g){a.jQXhrPost.isError=!0,BrowserAgent.logger.error("jQuery.ajaxSettings.xhrPost - Complete Post ("+a.origFunctionName+"): "+g.message)}return e})}),a.jQXhrPost.isVisited=!0)}}catch(d){BrowserAgent.logger.error("jQuery.ajaxSettings.xhrPost ("+a.origFunctionName+"): "+d.message)}}},init:function(){"undefined"!==typeof BrowserAgentExtension&&
BrowserAgentExtension.extAddJSFuncToInstrument();BrowserAgent.funcUtils.addFuncToCollection(BrowserAgent.globals.functionsToInstrumentList,"XMLHttpRequest.prototype.open",[{name:"BrowserAgent.funcUtils.tracers.xhrOpenPre",func:BrowserAgent.funcUtils.tracers.xhrOpenPre}]);BrowserAgent.funcUtils.addFuncToCollection(BrowserAgent.globals.functionsToInstrumentList,"XMLHttpRequest.prototype.send",[{name:"BrowserAgent.funcUtils.tracers.xhrSendPre",func:BrowserAgent.funcUtils.tracers.xhrSendPre}],[{name:"BrowserAgent.funcUtils.tracers.xhrSendPost",
func:BrowserAgent.funcUtils.tracers.xhrSendPost}]);window.history&&window.MutationObserver&&(BrowserAgent.funcUtils.addFuncToCollection(BrowserAgent.globals.functionsToInstrumentList,"history.pushState",[{name:"BrowserAgent.funcUtils.tracers.routeChangePre",func:BrowserAgent.funcUtils.tracers.routeChangePre}],[{name:"BrowserAgent.funcUtils.tracers.routeChangePost",func:BrowserAgent.funcUtils.tracers.routeChangePost}]),BrowserAgent.funcUtils.addFuncToCollection(BrowserAgent.globals.functionsToInstrumentList,
"history.replaceState",[{name:"BrowserAgent.funcUtils.tracers.routeChangePre",func:BrowserAgent.funcUtils.tracers.routeChangePre}],[{name:"BrowserAgent.funcUtils.tracers.routeChangePost",func:BrowserAgent.funcUtils.tracers.routeChangePost}]));BrowserAgent.funcUtils.addFuncToCollection(BrowserAgent.globals.functionsToInstrumentList,"jQuery.ajaxSettings.xhr",null,[{name:"BrowserAgent.funcUtils.tracers.jQuery.ajaxSettings.xhrPost",func:BrowserAgent.funcUtils.tracers["jQuery.ajaxSettings.xhrPost"]}]);
BrowserAgent.funcUtils.constructInstrumentFunctionList();BrowserAgent.funcUtils.instrumentAllFunc()},getFuncFromWindowScope:function(a){try{return eval("window."+a+";")}catch(b){}return null},constructInstrumentFunctionList:function(){var a,b,c,d,e,f,g,h,k,l;k={name:"BrowserAgent.funcUtils.tracers.JSFuncPre",func:BrowserAgent.funcUtils.tracers.JSFuncPre};l={name:"BrowserAgent.funcUtils.tracers.JSFuncPost",func:BrowserAgent.funcUtils.tracers.JSFuncPost};for(a=0;a<BrowserAgent.globals.functionsToInstrumentList.length;a++)if(f=
BrowserAgent.globals.functionsToInstrumentList[a],d=BrowserAgent.globals.extFuncMap[f.name],g=[],d&&!d.visited){for(b=0;b<d.pre.length;b++)(e=BrowserAgent.funcUtils.getFuncFromWindowScope(d.pre[b].name))?(d.pre[b].func=e,g.push(d.pre[b])):BrowserAgent.logger.warn("constructInstrumentFunctionList - 1: Could not find pre tracer ["+d.pre[b].name+"] for JS Function ["+f.name+"] in global scope.");BrowserAgent.globals.functionsToInstrumentList[a].pre=BrowserAgent.globals.functionsToInstrumentList[a].pre.concat(g);
h=[];for(b=0;b<d.post.length;b++)(e=BrowserAgent.funcUtils.getFuncFromWindowScope(d.post[b].name))?(d.post[b].func=e,h.push(d.post[b])):BrowserAgent.logger.warn("constructInstrumentFunctionList - 2: Could not find post tracer ["+d.post[b].name+"] for JS Function ["+f.name+"] in global scope.");BrowserAgent.globals.functionsToInstrumentList[a].pre.push(k);"history.pushState"===f.name||"history.replaceState"===f.name?(BrowserAgent.globals.functionsToInstrumentList[a].post.push(l),BrowserAgent.globals.functionsToInstrumentList[a].post=
BrowserAgent.globals.functionsToInstrumentList[a].post.concat(h)):(BrowserAgent.globals.functionsToInstrumentList[a].post=BrowserAgent.globals.functionsToInstrumentList[a].post.concat(h),BrowserAgent.globals.functionsToInstrumentList[a].post.unshift(l));d.visited=!0}for(c in BrowserAgent.globals.extFuncMap)if(d=BrowserAgent.globals.extFuncMap[c],!d.visited){g=[];for(b=0;b<d.pre.length;b++)(e=BrowserAgent.funcUtils.getFuncFromWindowScope(d.pre[b].name))?(d.pre[b].func=e,g.push(d.pre[b])):BrowserAgent.logger.warn("constructInstrumentFunctionList - 3: Could not find pre tracer ["+
d.pre[b].name+"] for JS Function ["+c+"] in global scope.");h=[];for(b=0;b<d.post.length;b++)(e=BrowserAgent.funcUtils.getFuncFromWindowScope(d.post[b].name))?(d.post[b].func=e,h.push(d.post[b])):BrowserAgent.logger.warn("constructInstrumentFunctionList - 4: Could not find post tracer ["+d.post[b].name+"] for JS Function ["+c+"] in global scope.");a={};a.name=c;a.pre=g;a.post=h;a.pre.push(k);a.post.unshift(l);BrowserAgent.globals.functionsToInstrumentList.push(a);d.visited=!0}},addFuncToCollection:function(a,
b,c,d){var e=BrowserAgent.browserUtils.getObjType(a);if("Array"!==e&&"Object"!==e)BrowserAgent.logger.warn("addFuncToCollection: collection ["+a+"] must be an array or a map");else if("Object"===e&&a[b])BrowserAgent.logger.warn("addFuncToCollection: JS Function ["+b+"] will NOT be added as it is already present.");else if("string"!==typeof b||1>b.length)BrowserAgent.logger.warn("addFuncToCollection: Could not add JS Function because function name ["+b+"] is invalid.");else{var f={};"Array"===BrowserAgent.browserUtils.getObjType(c)?
f.pre=c:(BrowserAgent.logger.info("addFuncToCollection: Found invalid or unspecified preTracerList for JS Function ["+b+"]. Defaulting to []."),f.pre=[]);"Array"===BrowserAgent.browserUtils.getObjType(d)?f.post=d:(BrowserAgent.logger.info("addFuncToCollection: Found invalid or unspecified postTracerList for JS Function ["+b+"]. Defaulting to []."),f.post=[]);"Array"===e?(f.name=b,a.push(f)):a[b]=f}},calculateAjaxRequestSize:function(a){var b=BrowserAgent.browserUtils.getObjType(a),c=null;if("String"===
b)c=a.length;else if("Blob"===b||"File"===b)c=a.size;else if("ArrayBuffer"===b||"DataView"===b)c=a.byteLength;return c},calculateAjaxResponseSize:function(a){var b=null;try{var c=a.getAllResponseHeaders(),d=a.responseType,e=c.indexOf(BrowserAgent.globals.contentLengthHdrStr)||c.indexOf(BrowserAgent.globals.contentLengthHdrStrLowerCase);if(-1!==e)b=Number(c.substring(e).split(/\n/)[0].split(/:\s*/)[1]);else if(""===d||"text"===d)b=a.responseText?a.responseText.length:null}catch(f){BrowserAgent.logger.warn("calculateAjaxResponseSize: Unable to obtain content length due to "+
f.message),b=null}return b},instrumentFunc:function(a,b,c,d,e){var f=BrowserAgent.funcUtils.getFuncFromWindowScope(a);if(!f)return e||BrowserAgent.logger.warn("instrumentFunc: JS Function ["+a+"] could not be found in the browser window scope. Scheduling retry..."),BrowserAgent.funcUtils.retryInstrumentFunc(a,b,c,d),null;if(f._BAState&&f._BAState.isInstrumented)return BrowserAgent.logger.info("instrumentFunc: JS Function ["+a+"] already instrumented. Skipping instrumentation..."),null;BrowserAgent.funcUtils.saveOrigObj(a,
f);if(!BrowserAgent.globals.origFuncMap||!BrowserAgent.globals.origFuncMap[a])return BrowserAgent.logger.warn("instrumentFunc: JS Function ["+a+"] could not be saved. Skipping instrumentation..."),null;BrowserAgent.logger.info("instrumentFunc: Instrumenting JS Function ["+a+"]...");var g=function(){var d,e=[],l=!1;try{for(g._BAState.invocationData=arguments,d=0;d<b.length;d++)b[d].args&&(e=b[d].args),e.push(g._BAState),b[d].func.apply(this,e)}catch(m){l=!0,BrowserAgent.logger.error("instrumentFunc: Error in pre tracer(s) for JS Function ["+
a+"] - "+m.message)}var n=f.apply(this,arguments);try{g._BAState.funcRetVal=n;if(l)return n;for(d=0;d<c.length;d++)c[d].args&&(e=c[d].args),e.push(g._BAState),c[d].func.apply(this,e)}catch(q){BrowserAgent.logger.error("instrumentFunc: Error in post tracer(s) for JS Function ["+a+"] - "+q.message)}return n};g&&(g._BAState={},g._BAState.isInstrumented=!0,g._BAState.origFunctionName=a);BrowserAgent.logger.info("instrumentFunc: Finished instrumentation for JS Function ["+a+"].");BrowserAgent.globals.retryFuncIdMap[a]&&
delete BrowserAgent.globals.retryFuncIdMap[a];return g},retryInstrumentFunc:function(a,b,c,d){0>d?(BrowserAgent.logger.warn("retryInstrumentFunc: Well, this is embarrassing. JS Function ["+a+"] could not be instrumented as it is not found even after several retries."),BrowserAgent.globals.retryFuncIdMap[a]&&delete BrowserAgent.globals.retryFuncIdMap[a]):BrowserAgent.globals.retryFuncIdMap[a]=setTimeout(function(){BrowserAgent.funcUtils.assignFunc(a,BrowserAgent.funcUtils.instrumentFunc(a,b,c,d-1,
!0))},BrowserAgent.globals.retryInterval)},instrumentAllFunc:function(){if(BrowserAgent.globals.functionsToInstrumentList){window&&window.XMLHttpRequest&&(BrowserAgent.funcUtils.saveOrigObj("XHR_ctor",window.XMLHttpRequest),BrowserAgent.funcUtils.saveOrigObj("XHR_ctor_open",window.XMLHttpRequest.prototype.open),BrowserAgent.funcUtils.saveOrigObj("XHR_ctor_send",window.XMLHttpRequest.prototype.send));var a,b,c,d;for(a=0;a<BrowserAgent.globals.functionsToInstrumentList.length;a++){b=BrowserAgent.globals.functionsToInstrumentList[a].name;
c=BrowserAgent.globals.functionsToInstrumentList[a].pre;d=BrowserAgent.globals.functionsToInstrumentList[a].post;try{BrowserAgent.funcUtils.assignFunc(b,BrowserAgent.funcUtils.instrumentFunc(b,c,d,BrowserAgent.globals.funcInstrumentMaxRetryCount,!1))}catch(e){}}}else BrowserAgent.logger.info("instrumentAllFunc: No JS Functions to instrument.")},assignFunc:function(a,b){b&&eval("window."+a+" \x3d b;")},saveOrigObj:function(a,b){b&&a?BrowserAgent.globals.origFuncMap[a]=b:BrowserAgent.logger.warn("saveOrigObj : Cannot save original object without key or the object itself.")}};
BrowserAgent.jsonUtils={jsonConstants:{SCHEMA_VERSION:"2.0",CREATOR_NAME:"BA",CREATOR_VERSION:"1.0",APP_VERSION:"1.0"},createTT:function(a,b,c,d,e,f,g,h){var k={},l=!1,m=c;if(0<c&&0<d&&0<f&&0<g&&(c>d||c+e<d)){if(!h||isNaN(h)||h<d)h=d;m=c+Math.ceil((f-(h-d))/2)+h-g;m>d&&(m=d)}a&&(k.path=a,l=!0);"number"!==typeof e||isNaN(e)||(k.duration=e,l=!0);d&&b&&(k.correlationBrowserGUID=b,l=!0);"number"!==typeof c||isNaN(c)||(k.startTime=c,l=!0);d&&b&&"number"===typeof m&&!isNaN(m)&&(k.adjustedStartTime=m,l=
!0);if("undefined"!==typeof BrowserAgentExtension&&(BrowserAgentExtension.extAddCustomOptionalProperty(),0<BrowserAgentExtension.extCustomOptionalPropertyList.length)){a=[];for(b=0;b<BrowserAgentExtension.extCustomOptionalPropertyList.length;b++)c=BrowserAgentExtension.extCustomOptionalPropertyList[b],BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createXAttribute(c.name,c.value,c.description),a);0<a.length&&(k.x_attributes={x_attributeList:a},l=!0);BrowserAgentExtension.extCustomOptionalPropertyList=
[]}return l?k:null},createMetric:function(a,b,c,d,e){if(!BrowserAgent.jsonUtils.validateMetric(a,b,c,d,e))return BrowserAgent.logger.info("createMetric: Invalid metric input. Discard metric..."),null;if("undefined"!==typeof BrowserAgentExtension){var f=BrowserAgentExtension.extNameFormatter(a,b,c,d,e);if(f){if(!BrowserAgent.jsonUtils.validateMetric(f.path,f.name,f.unit,f.accumulatorType,f.value))return BrowserAgent.logger.info("createMetric: Invalid metric input after Name Formatter. Discard metric..."),
null;a=f.path;b=f.name;c=f.unit;d=f.accumulatorType;e=f.value}}a={path:a,name:b,accumulatorType:d,value:e};0===d&&c&&(a.unit=c);return a},validateMetric:function(a,b,c,d,e){if("string"!==typeof a||0===a.length||"string"!==typeof b||0===b.length||"number"!==typeof d||"number"!==typeof e||isNaN(e)||0>e)return!1;for(var f in BrowserAgent.globals.metricAggregatorType)if(d===BrowserAgent.globals.metricAggregatorType[f])return!0;return!1},createBS:function(a,b,c){return a&&a!==BrowserAgent.globals.UNDEFINED?
{name:a,businessTransactionList:[{name:b,transactions:{transactionList:[{name:c}]}}]}:null},addToList:function(a,b){b&&a&&b.push(a)},createAPMData:function(a,b){var c={},d=!1;a&&0<a.length&&(c.metrics={metricList:a},d=!0);b&&0<b.length&&(c.transactionTraces={transactionTraceList:b},d=!0);return d?c:null},createRequest:function(a,b,c){var d={},e=!1;"string"===typeof a&&0<a.length&&(d.url=a,e=!0);"string"===typeof b&&0<b.length&&(d.method=b.toUpperCase(),e=!0);"number"===typeof c&&0<c&&(d.bodySize=
c,e=!0);return e?d:null},createResponse:function(a,b){var c={},d=!1;"number"===typeof a&&(c.status=a,d=!0);b&&(c.content=b,d=!0);return d?c:null},createContent:function(a){var b={},c=!1;"number"===typeof a&&(b.size=a,c=!0);return c?b:null},createResource:function(a,b,c,d,e,f,g){var h={},k=!1;"string"===typeof a&&(h.type=a);"number"===typeof b&&(h.timeStamp=b);c&&(h.businessService=c);d&&(h.apmData=d,k=!0);e&&(h.request=e,k=!0);f&&(h.response=f,k=!0);g&&(h.axaData=g,k=!0);return k?h:null},createError:function(a,
b,c,d,e,f,g,h,k,l){var m={},n=!1;a&&(m.type=a,n=!0);b&&(m.subType=b,n=!0);"string"===typeof c&&(m.message=c,n=!0);d&&(m.source=d,n=!0);e&&(m.lineNumber=e,n=!0);f&&(m.columnNumber=f,n=!0);g&&(m.stackTrace=g,n=!0);"number"===typeof h&&(m.timeStamp=h,n=!0);k&&(m.apmData=k,n=!0);l&&(m.axaData=l,n=!0);return n?m:null},createXAttribute:function(a,b,c){if(!a||!b)return null;var d={};d.name=a;d.value=b.toString();c&&(d.description=c);return d},createCookies:function(a){if(!a)return null;var b=[],c=!1,d;for(d in a)d&&
a[d]&&(b.push({name:d,value:a[d]}),c=!0);return c?{cookieList:b}:null},createAXAData:function(a){return a&&0<a.length?{axaEventList:a}:null},createInternalData:function(a,b){if(!a)return null;var c=BrowserAgent.globals.agentCookiePrefix,d,e={},f,g=[],h;for(h in b)d=c+b[h],a[d]&&(e[d]=a[d],f=!0,delete a[d]);for(h in a)g.push(BrowserAgent.jsonUtils.createXAttribute(h,a[h])),f=!0;0<g.length&&(e.x_attributes={x_attributeList:g});return f?e:null},updateEUMWithGeo:function(a){var b=BrowserAgent.storageUtils.getFromStorage(BrowserAgent.storageUtils.storageTypes.SESSION,
BrowserAgent.storageUtils.storageKeys.GEOCUSTOM),c=null;null!==b&&(c=JSON.parse(b),BrowserAgent.globals.geo.lat=c.lat,BrowserAgent.globals.geo.lon=c.lon);a.clientInfo.geolocation&&null===c||(b=BrowserAgent.globals.geo)&&b.lat&&b.lon&&-90<=b.lat&&90>=b.lat&&-180<=b.lon&&180>=b.lon&&(a.clientInfo.geolocation={latitude:b.lat,longitude:b.lon})}};BrowserAgent.evtUtils={init:function(){BrowserAgent.evtUtils.setEvtHndlr(BrowserAgent.globals.evtTypes.HPLOAD,BrowserAgent.evtUtils.handleHPLoadEvt);BrowserAgent.evtUtils.setEvtHndlr(BrowserAgent.globals.evtTypes.SPLOAD,
BrowserAgent.evtUtils.handleSPLoadEvt);BrowserAgent.evtUtils.setEvtHndlr(BrowserAgent.globals.evtTypes.RES,BrowserAgent.evtUtils.handleResEvt);BrowserAgent.evtUtils.setEvtHndlr(BrowserAgent.globals.evtTypes.JSERR,BrowserAgent.evtUtils.handleJSErrEvt);BrowserAgent.evtUtils.setEvtHndlr(BrowserAgent.globals.evtTypes.FN,BrowserAgent.evtUtils.handleFnEvt);BrowserAgent.evtUtils.setEvtHndlr(BrowserAgent.globals.evtTypes.APMEXT,BrowserAgent.evtUtils.handleAPMExtEvt);BrowserAgent.evtUtils.setEvtHndlr(BrowserAgent.globals.evtTypes.AXAEXT,
BrowserAgent.evtUtils.handleAXAExtEvt);BrowserAgent.evtUtils.setEvtHndlr(BrowserAgent.globals.evtTypes.TTIME,BrowserAgent.evtUtils.handleTTimeEvt)},isValidResEvt:function(a){if(!a)return!1;var b=!1;a[BrowserAgent.globals.timestampNames.END_TIME]&&a[BrowserAgent.globals.ajaxDataKeys.URL]&&a[BrowserAgent.globals.timestampNames.CALLBACK_END_TIME]&&(b=!0);return BrowserAgent.globals.isJQOne?b:b&&a[BrowserAgent.globals.timestampNames.LAST_BYTE]&&a[BrowserAgent.globals.timestampNames.FIRST_BYTE]?!0:!1},
getEvtObject:function(a,b,c){var d=Date.now();if(BrowserAgent.globals.currPagePtr.isExcluded)return null;var e=BrowserAgent.globals.getSequenceNum();BrowserAgent.browserUtils.isSameSession(d)?BrowserAgent.storageUtils.putInStorage(BrowserAgent.storageUtils.storageTypes.SESSION,BrowserAgent.storageUtils.storageKeys.BALASTEVENT_TIME,d,!0):BrowserAgent.pageUtils.addNewPageBucket(BrowserAgent.globals.currPagePtr.json.pageType,BrowserAgent.globals.currPagePtr.json.url,d,!1,BrowserAgent.browserUtils.cloneTrackerData());
BrowserAgent.globals.currPagePtr.evtMap[e]={id:e,type:a};BrowserAgent.globals.currPagePtr.evtCount+=1;BrowserAgent.globals.pageWithEventsMap[BrowserAgent.globals.currPagePtr.id]=1;b&&(BrowserAgent.globals.currPagePtr.evtMap[e][BrowserAgent.globals.trackerDataKey]=BrowserAgent.browserUtils.cloneTrackerData());c&&(BrowserAgent.globals.currPagePtr.evtMap[e][c]=d);return BrowserAgent.globals.currPagePtr.evtMap[e]},setEvtHndlr:function(a,b){BrowserAgent.globals.evtTypes[a]&&"function"===typeof b?BrowserAgent.globals.evtHandlers[a]=
b:BrowserAgent.logger.warn("setEvtHndlr: Cannot set event handler for event type ["+a+"]")},handleHPLoadEvt:function(a,b,c){if(!c)return!1;if(!a||!b||!BrowserAgent.globals.configs.PAGELOADMETRICSENABLED)return c.isDelete=!0,!1;b.pageLoadFlag=!0;if(!c.raw)return c.isDelete=!0,BrowserAgent.logger.warn("handleHPLoadEvt: Obtained invalid page load data point. Deleting it..."),!1;var d=c.raw.loadEventEnd-c.raw.navigationStart;if(0<d&&d<BrowserAgent.globals.configs.PAGELOADMETRICSTHRESHOLD)return BrowserAgent.logger.info("handleHPLoadEvt: Skipping harvest of Page metrics for as it is below the configured Page metric threshold ("+
BrowserAgent.globals.configs.PAGELOADMETRICSTHRESHOLD+" ms)"),c.isDelete=!0,!1;if(!b.businessService&&BrowserAgent.globals.configs.URLMETRICOFF)return BrowserAgent.logger.info("handleHPLoadEvt: Skipping harvest of Page metrics as URL metric context is DISABLED"),c.isDelete=!0,!1;var e=null;BrowserAgent.globals.initPageInfo.pageMetricPathNoHash&&(e=a,a=BrowserAgent.globals.initPageInfo.pageMetricPathNoHash);var f=c.raw.responseStart-c.raw.requestStart,g=[];BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(a,
BrowserAgent.globals.defaultMetricDefs.NTAPI_PRT.name,BrowserAgent.globals.defaultMetricDefs.NTAPI_PRT.unit,BrowserAgent.globals.defaultMetricDefs.NTAPI_PRT.type,c.raw.loadEventEnd-c.raw.domComplete),g);BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(a,BrowserAgent.globals.defaultMetricDefs.NTAPI_CET.name,BrowserAgent.globals.defaultMetricDefs.NTAPI_CET.unit,BrowserAgent.globals.defaultMetricDefs.NTAPI_CET.type,c.raw.connectEnd-c.raw.connectStart),g);BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(a,
BrowserAgent.globals.defaultMetricDefs.NTAPI_DLT.name,BrowserAgent.globals.defaultMetricDefs.NTAPI_DLT.unit,BrowserAgent.globals.defaultMetricDefs.NTAPI_DLT.type,c.raw.domainLookupEnd-c.raw.domainLookupStart),g);BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(a,BrowserAgent.globals.defaultMetricDefs.NTAPI_DPT.name,BrowserAgent.globals.defaultMetricDefs.NTAPI_DPT.unit,BrowserAgent.globals.defaultMetricDefs.NTAPI_DPT.type,c.raw.domComplete-c.raw.domLoading),g);BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(a,
BrowserAgent.globals.defaultMetricDefs.NTAPI_PLT.name,BrowserAgent.globals.defaultMetricDefs.NTAPI_PLT.unit,BrowserAgent.globals.defaultMetricDefs.NTAPI_PLT.type,d),g);BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(a,BrowserAgent.globals.defaultMetricDefs.NTAPI_PST.name,BrowserAgent.globals.defaultMetricDefs.NTAPI_PST.unit,BrowserAgent.globals.defaultMetricDefs.NTAPI_PST.type,c.raw.connectStart-c.raw.domainLookupEnd+c.raw.requestStart-c.raw.connectEnd),g);BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(a,
BrowserAgent.globals.defaultMetricDefs.NTAPI_PPUT.name,BrowserAgent.globals.defaultMetricDefs.NTAPI_PPUT.unit,BrowserAgent.globals.defaultMetricDefs.NTAPI_PPUT.type,c.raw.unloadEventEnd-c.raw.unloadEventStart),g);BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(a,BrowserAgent.globals.defaultMetricDefs.NTAPI_TTFB.name,BrowserAgent.globals.defaultMetricDefs.NTAPI_TTFB.unit,BrowserAgent.globals.defaultMetricDefs.NTAPI_TTFB.type,f),g);BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(a,
BrowserAgent.globals.defaultMetricDefs.NTAPI_TTLB.name,BrowserAgent.globals.defaultMetricDefs.NTAPI_TTLB.unit,BrowserAgent.globals.defaultMetricDefs.NTAPI_TTLB.type,c.raw.responseEnd-c.raw.requestStart),g);BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(a,BrowserAgent.globals.defaultMetricDefs.PAGE_HPI.name,BrowserAgent.globals.defaultMetricDefs.PAGE_HPI.unit,BrowserAgent.globals.defaultMetricDefs.PAGE_HPI.type,1),g);e&&(BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(e,
BrowserAgent.globals.defaultMetricDefs.NTAPI_PLT.name,BrowserAgent.globals.defaultMetricDefs.NTAPI_PLT.unit,BrowserAgent.globals.defaultMetricDefs.NTAPI_PLT.type,d),g),BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(e,BrowserAgent.globals.defaultMetricDefs.PAGE_HPI.name,BrowserAgent.globals.defaultMetricDefs.PAGE_HPI.unit,BrowserAgent.globals.defaultMetricDefs.PAGE_HPI.type,1),g));if("undefined"!==typeof BrowserAgentExtension&&(BrowserAgentExtension.extAddCustomPageMetric(),0<
BrowserAgentExtension.extCustomPageMetricList.length)){for(e=0;e<BrowserAgentExtension.extCustomPageMetricList.length;e++){var h=BrowserAgentExtension.extCustomPageMetricList[e];BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(a,h.name,h.unit,h.accumulatorType,h.value),g)}BrowserAgentExtension.extCustomPageMetricList=[]}e=[];BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createTT(0<g.length?g[0].path:a,BrowserAgent.globals.CorBrowsGUID,c.raw.navigationStart,parseInt(BrowserAgent.globals.startTime),
d,f,c.raw.responseStart,parseInt(BrowserAgent.globals.endTime)),e);a=!1;g=BrowserAgent.jsonUtils.createAPMData(g,e);d=BrowserAgent.jsonUtils.createAXAData(c[BrowserAgent.globals.trackerDataKey]);b.rawData={navigationTiming:BrowserAgent.browserUtils.copyObj(c.raw)};BrowserAgent.globals.agentCookies&&(c=BrowserAgent.jsonUtils.createInternalData(BrowserAgent.globals.agentCookies,BrowserAgent.globals.agentCookieKeyName))&&(b.internalData=c);g&&(b.apmData=g,a=!0);d&&(b.axaData=d,a=!0);return a},handleSPLoadEvt:function(a,
b,c){if(!c)return!1;if(!a||!b||!BrowserAgent.globals.configs.PAGELOADMETRICSENABLED)return c.isDelete=!0,!1;b.pageLoadFlag=!0;if(!c[BrowserAgent.globals.softPageDataKeys.START]||!c[BrowserAgent.globals.softPageDataKeys.END])return c.isDelete=!0,BrowserAgent.logger.warn("handleSPLoadEvt: Obtained invalid page load data point. Deleting it..."),!1;var d=c[BrowserAgent.globals.softPageDataKeys.END]-c[BrowserAgent.globals.softPageDataKeys.START];if(0<d&&d<BrowserAgent.globals.configs.PAGELOADMETRICSTHRESHOLD)return BrowserAgent.logger.info("handleSPLoadEvt: Skipping harvest of Soft Page metrics for as it is below the configured Page metric threshold ("+
BrowserAgent.globals.configs.PAGELOADMETRICSTHRESHOLD+" ms)"),c.isDelete=!0,!1;if(!b.businessService&&BrowserAgent.globals.configs.URLMETRICOFF)return BrowserAgent.logger.info("handleSPLoadEvt: Skipping harvest of Page metrics as URL metric context is DISABLED"),c.isDelete=!0,!1;var e=[];BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(a,BrowserAgent.globals.defaultMetricDefs.NTAPI_PLT.name,BrowserAgent.globals.defaultMetricDefs.NTAPI_PLT.unit,BrowserAgent.globals.defaultMetricDefs.NTAPI_PLT.type,
d),e);BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(a,BrowserAgent.globals.defaultMetricDefs.PAGE_HPI.name,BrowserAgent.globals.defaultMetricDefs.PAGE_HPI.unit,BrowserAgent.globals.defaultMetricDefs.PAGE_HPI.type,1),e);a=!1;e=BrowserAgent.jsonUtils.createAPMData(e,null);d=BrowserAgent.jsonUtils.createAXAData(c[BrowserAgent.globals.trackerDataKey]);b.rawData={softPageTiming:{startTime:c[BrowserAgent.globals.softPageDataKeys.START],endTime:c[BrowserAgent.globals.softPageDataKeys.END]}};
e&&(b.apmData=e,a=!0);d&&(b.axaData=d,a=!0);return a},handleResEvt:function(a,b,c){if(!c)return!1;if(!(a&&b&&BrowserAgent.evtUtils.isValidResEvt(c)&&BrowserAgent.globals.configs.AJAXMETRICSENABLED))return BrowserAgent.logger.warn("handleResEvt: Obtained invalid AJAX data point or AJAX metrics disabled. Deleting it..."),c.isDelete=!0,!1;var d=c[BrowserAgent.globals.timestampNames.CALLBACK_END_TIME]-c[BrowserAgent.globals.timestampNames.END_TIME];if(0<d&&d<BrowserAgent.globals.configs.AJAXMETRICSTHRESHOLD)return BrowserAgent.logger.info("handleResEvt: Skipping harvest of resource metrics for "+
c[BrowserAgent.globals.ajaxDataKeys.URL]+" as it is below the configured resource metric threshold"),c.isDelete=!0,!1;var e=c[BrowserAgent.cookieUtils.cookieKeys.bsChar]&&c[BrowserAgent.cookieUtils.cookieKeys.bsChar]!==BrowserAgent.globals.UNDEFINED;if(!e&&!b.businessService&&BrowserAgent.globals.configs.URLMETRICOFF)return BrowserAgent.logger.info("handleResEvt: Skipping harvest of AJAX metrics as NON-BT based metrics are OFF"),c.isDelete=!0,!1;e&&(a=BrowserAgent.globals.metricPathConsts.PREFIX+
BrowserAgent.globals.pipeChar+c[BrowserAgent.cookieUtils.cookieKeys.bsChar]+BrowserAgent.globals.pipeChar+c[BrowserAgent.cookieUtils.cookieKeys.btChar]+BrowserAgent.globals.pipeChar+c[BrowserAgent.cookieUtils.cookieKeys.btcChar]+BrowserAgent.globals.pipeChar+BrowserAgent.globals.metricPathConsts.BROWSER);var e=BrowserAgent.jsonUtils.createBS(c[BrowserAgent.cookieUtils.cookieKeys.bsChar],c[BrowserAgent.cookieUtils.cookieKeys.btChar],c[BrowserAgent.cookieUtils.cookieKeys.btcChar]),f=BrowserAgent.browserUtils.parseURL(c[BrowserAgent.globals.ajaxDataKeys.URL]),
g=c[BrowserAgent.globals.timestampNames.FIRST_BYTE]-c[BrowserAgent.globals.timestampNames.END_TIME],h=c[BrowserAgent.globals.timestampNames.LAST_BYTE]-c[BrowserAgent.globals.timestampNames.FIRST_BYTE];a+=BrowserAgent.globals.pipeChar+BrowserAgent.globals.metricPathConsts.AJAX+BrowserAgent.globals.pipeChar+(f.hostname+BrowserAgent.globals.forwardSlashChar+f.port+BrowserAgent.globals.pipeChar+f.pathname);f=[];BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(a,BrowserAgent.globals.defaultMetricDefs.AJAX_RLT.name,
BrowserAgent.globals.defaultMetricDefs.AJAX_RLT.unit,BrowserAgent.globals.defaultMetricDefs.AJAX_RLT.type,d),f);0<=g&&BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(a,BrowserAgent.globals.defaultMetricDefs.AJAX_TTFB.name,BrowserAgent.globals.defaultMetricDefs.AJAX_TTFB.unit,BrowserAgent.globals.defaultMetricDefs.AJAX_TTFB.type,g),f);0<=h&&BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(a,BrowserAgent.globals.defaultMetricDefs.AJAX_RDT.name,BrowserAgent.globals.defaultMetricDefs.AJAX_RDT.unit,
BrowserAgent.globals.defaultMetricDefs.AJAX_RDT.type,h),f);BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(a,BrowserAgent.globals.defaultMetricDefs.AJAX_CBET.name,BrowserAgent.globals.defaultMetricDefs.AJAX_CBET.unit,BrowserAgent.globals.defaultMetricDefs.AJAX_CBET.type,c[BrowserAgent.globals.timestampNames.CALLBACK_END_TIME]-c[BrowserAgent.globals.timestampNames.CALLBACK_START_TIME]),f);BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(a,BrowserAgent.globals.defaultMetricDefs.AJAX_ICPI.name,
BrowserAgent.globals.defaultMetricDefs.AJAX_ICPI.unit,BrowserAgent.globals.defaultMetricDefs.AJAX_ICPI.type,1),f);if("undefined"!==typeof BrowserAgentExtension&&(BrowserAgentExtension.extAddCustomAjaxMetric(),0<BrowserAgentExtension.extCustomAjaxMetricList.length)){for(h=0;h<BrowserAgentExtension.extCustomAjaxMetricList.length;h++){var k=BrowserAgentExtension.extCustomAjaxMetricList[h];BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(a,k.name,k.unit,k.accumulatorType,k.value),
f)}BrowserAgentExtension.extCustomAjaxMetricList=[]}h=[];BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createTT(0<f.length?f[0].path:a,c[BrowserAgent.cookieUtils.cookieKeys.CorBrowsGUIDChar],c[BrowserAgent.globals.timestampNames.END_TIME],parseInt(c[BrowserAgent.cookieUtils.cookieKeys.apmStartTimeChar]),d,g,c[BrowserAgent.globals.timestampNames.FIRST_BYTE],parseInt(c[BrowserAgent.cookieUtils.cookieKeys.apmEndTimeChar])),h);a=BrowserAgent.jsonUtils.createResource(BrowserAgent.globals.resourceType.AJAX,
c[BrowserAgent.globals.timestampNames.END_TIME],e,BrowserAgent.jsonUtils.createAPMData(f,h),BrowserAgent.jsonUtils.createRequest(c[BrowserAgent.globals.ajaxDataKeys.URL],c[BrowserAgent.globals.ajaxDataKeys.METHOD],c[BrowserAgent.globals.ajaxDataKeys.REQUEST_BODY_SIZE]),BrowserAgent.jsonUtils.createResponse(c[BrowserAgent.globals.ajaxDataKeys.STATUS_CODE],BrowserAgent.jsonUtils.createContent(c[BrowserAgent.globals.ajaxDataKeys.RESPONSE_CONTENT_LENGTH])),BrowserAgent.jsonUtils.createAXAData(c[BrowserAgent.globals.trackerDataKey]));
d=BrowserAgent.globals.agentCookieKeys;c[d]&&(c=BrowserAgent.jsonUtils.createInternalData(c[d],BrowserAgent.globals.agentCookieKeyName))&&(a.internalData=c);return a?(b.resources||(b.resources={resourceList:[]}),b.resources.resourceList.push(a),!0):!1},handleJSErrEvt:function(a,b,c){if(!c)return!1;if(!a||!b||!BrowserAgent.globals.configs.JSERRORSENABLED)return c.isDelete=!0,!1;if("string"!==typeof c[BrowserAgent.errorUtils.errorDataFields.MSG]||"number"!==typeof c[BrowserAgent.errorUtils.errorDataFields.STT])return BrowserAgent.logger.info("handleJSErrEvt: Obtained an invalid JS error data point. Deleting it..."),
c.isDelete=!0,!1;if(!b.businessService&&BrowserAgent.globals.configs.URLMETRICOFF)return BrowserAgent.logger.info("handleJSErrEvt: Skipping harvest of JS error metrics as NON-BT based metrics are OFF"),c.isDelete=!0,!1;var d={timeStamp:c[BrowserAgent.errorUtils.errorDataFields.STT],message:c[BrowserAgent.errorUtils.errorDataFields.MSG]};if(a=BrowserAgent.jsonUtils.createMetric(a,BrowserAgent.globals.defaultMetricDefs.JSERR_CPI.name,BrowserAgent.globals.defaultMetricDefs.JSERR_CPI.unit,BrowserAgent.globals.defaultMetricDefs.JSERR_CPI.type,
1))if(a=BrowserAgent.jsonUtils.createAPMData([a],null))d.apmData=a;if(a=BrowserAgent.jsonUtils.createAXAData(c[BrowserAgent.globals.trackerDataKey]))d.axaData=a;c[BrowserAgent.errorUtils.errorDataFields.TYP]&&(d.type=c[BrowserAgent.errorUtils.errorDataFields.TYP]);c[BrowserAgent.errorUtils.errorDataFields.SUB]&&(d.subType=c[BrowserAgent.errorUtils.errorDataFields.SUB]);c[BrowserAgent.errorUtils.errorDataFields.SRC]&&(d.source=c[BrowserAgent.errorUtils.errorDataFields.SRC]);c[BrowserAgent.errorUtils.errorDataFields.LIN]&&
(d.lineNumber=c[BrowserAgent.errorUtils.errorDataFields.LIN]);c[BrowserAgent.errorUtils.errorDataFields.COL]&&(d.columnNumber=c[BrowserAgent.errorUtils.errorDataFields.COL]);c[BrowserAgent.errorUtils.errorDataFields.STK]&&(d.stackTrace=c[BrowserAgent.errorUtils.errorDataFields.STK]);return d?(b.errors||(b.errors={errorList:[]}),b.errors.errorList.push(d),!0):!1},handleFnEvt:function(a,b,c){if(!c)return!1;if(!a||!b||!BrowserAgent.globals.configs.JSFUNCTIONMETRICSENABLED)return c.isDelete=!0,!1;if(!c[BrowserAgent.globals.timestampNames.START_TIME]||
!c[BrowserAgent.globals.timestampNames.END_TIME]||!c.fnName)return BrowserAgent.logger.warn("handleFnEvt: Obtained invalid JS Function data point. Deleting it..."),c.isDelete=!0,!1;if(!b.businessService&&BrowserAgent.globals.configs.URLMETRICOFF)return BrowserAgent.logger.info("handleFnEvt: Skipping harvest of JS Function metrics as NON-BT based metrics are OFF"),c.isDelete=!0,!1;var d=c[BrowserAgent.globals.timestampNames.END_TIME]-c[BrowserAgent.globals.timestampNames.START_TIME];if(0<d&&d<BrowserAgent.globals.configs.JSFUNCTIONMETRICSTHRESHOLD)return BrowserAgent.logger.info("handleFnEvt: Skipping harvest of JS function metrics for "+
c.fnName+" as it is below the configured JS Function metric threshold"),c.isDelete=!0,!1;a+=BrowserAgent.globals.pipeChar+BrowserAgent.globals.metricPathConsts.FUNC+BrowserAgent.globals.pipeChar+c.fnName;var e=[];e.push(BrowserAgent.jsonUtils.createMetric(a,BrowserAgent.globals.defaultMetricDefs.FUNC_ET.name,BrowserAgent.globals.defaultMetricDefs.FUNC_ET.unit,BrowserAgent.globals.defaultMetricDefs.FUNC_ET.type,d));e.push(BrowserAgent.jsonUtils.createMetric(a,BrowserAgent.globals.defaultMetricDefs.FUNC_ICPI.name,
BrowserAgent.globals.defaultMetricDefs.FUNC_ICPI.unit,BrowserAgent.globals.defaultMetricDefs.FUNC_ICPI.type,1));if("undefined"!==typeof BrowserAgentExtension&&(BrowserAgentExtension.extAddCustomJSFuncMetric(),0<BrowserAgentExtension.extCustomJSFuncMetricList.length)){for(d=0;d<BrowserAgentExtension.extCustomJSFuncMetricList.length;d++){var f=BrowserAgentExtension.extCustomJSFuncMetricList[d];BrowserAgent.jsonUtils.addToList(BrowserAgent.jsonUtils.createMetric(a,f.name,f.unit,f.accumulatorType,f.value),
e)}BrowserAgentExtension.extCustomJSFuncMetricList=[]}a=BrowserAgent.jsonUtils.createAPMData(e,null);if(!a)return!1;a={timeStamp:c[BrowserAgent.globals.timestampNames.START_TIME],apmData:a};if(c=BrowserAgent.jsonUtils.createAXAData(c[BrowserAgent.globals.trackerDataKey]))a.axaData=c;return a?(b.clientEvents||(b.clientEvents={clientEventList:[]}),b.clientEvents.clientEventList.push(a),!0):!1},handleAPMExtEvt:function(a,b,c){if(!c)return!1;if(!a||!b||!BrowserAgent.globals.configs.BROWSERAGENTENABLED)return c.isDelete=
!0,!1;if(!c.lst||1>c.lst.length)return BrowserAgent.logger.info("handleAPMExtEvt: Obtained invalid APM extension metrics list. Deleting it..."),c.isDelete=!0,!1;if(!b.businessService&&BrowserAgent.globals.configs.URLMETRICOFF)return BrowserAgent.logger.info("handleAPMExtEvt: Skipping harvest of APM extension metrics as NON-BT based metrics are OFF"),c.isDelete=!0,!1;a=BrowserAgent.jsonUtils.createAPMData(c.lst,null);if(!a)return!1;a={apmData:a};b.extensions||(b.extensions={extensionList:[]});b.extensions.extensionList.push(a);
return!0},handleAXAExtEvt:function(a,b,c){if(!c)return!1;if(!a||!b||!BrowserAgent.globals.configs.BROWSERAGENTENABLED)return c.isDelete=!0,!1;if(!c.d||1>c.d.length)return BrowserAgent.logger.info("handleAXAExtEvt: Obtained invalid AXA extension data. Deleting it..."),c.isDelete=!0,!1;b.axaData||(b.axaData={axaEventList:[]});b.axaData.axaEventList.push(c.d);return!0},handleTTimeEvt:function(a,b,c){if(!c)return!1;if(!a||!b||!BrowserAgent.globals.configs.BROWSERAGENTENABLED)return c.isDelete=!0,!1;if(!c.s||
!c.e||c.e<c.s)return BrowserAgent.logger.info("handleTTimeEvt: Obtained invalid think time data. Deleting it..."),c.isDelete=!0,!1;if(!b.businessService&&BrowserAgent.globals.configs.URLMETRICOFF)return BrowserAgent.logger.info("handleTTimeEvt: Skipping harvest of think time metric(s) as NON-BT based metrics are OFF"),c.isDelete=!0,!1;a=BrowserAgent.jsonUtils.createMetric(a,BrowserAgent.globals.defaultMetricDefs.PAGE_UDT.name,BrowserAgent.globals.defaultMetricDefs.PAGE_UDT.unit,BrowserAgent.globals.defaultMetricDefs.PAGE_UDT.type,
c.e-c.s);if(!a)return!1;a=BrowserAgent.jsonUtils.createAPMData([a],null);if(!a)return!1;a={desc:"pageThinkTime",startTime:c.s,endTime:c.e,apmData:a};if(c=BrowserAgent.jsonUtils.createAXAData(c[BrowserAgent.globals.trackerDataKey]))a.axaData=c;return a?(b.thinkTimes||(b.thinkTimes={thinkTimeList:[]}),b.thinkTimes.thinkTimeList.push(a),!0):!1},harvestEvts:function(){var a,b,c,d,e,f=[];for(a in BrowserAgent.globals.pageWithEventsMap){e=!1;b=BrowserAgent.globals.pageBucketsMap[a];d=JSON.parse(JSON.stringify(b.json));
for(c in b.evtMap)b.evtMap[c].isDelete?(delete b.evtMap[c],b.evtCount-=1):b.evtMap[c].isDone&&(e=BrowserAgent.globals.evtHandlers[b.evtMap[c].type](b.pageMetricPath,d,b.evtMap[c])||e,delete b.evtMap[c],b.evtCount-=1);1>b.evtCount&&delete BrowserAgent.globals.pageWithEventsMap[a];if(!0===b.newPage&&!0===BrowserAgent.globals.configs.COOKIECAPTUREENABLED){if(e=BrowserAgent.jsonUtils.createCookies(BrowserAgent.cookieUtils.getAppCookies()))d.cookies=e;b.newPage=!1;e=!0}e?(f.push(d),b.json.pageLoadFlag&&
(b.json.pageLoadFlag=!1),b.json.sessions.sessionList[0].newSessionFlag&&(b.json.sessions.sessionList[0].newSessionFlag=!1)):!0===d.pageLoadFlag&&(b.json.pageLoadFlag=!0)}0<f.length&&(BrowserAgent.jsonUtils.updateEUMWithGeo(BrowserAgent.globals.eumJSONShell),a=JSON.parse(JSON.stringify(BrowserAgent.globals.eumJSONShell)),a.app.ba.pages.pageList=f,BrowserAgent.evtUtils.sendEvts(BrowserAgent.globals.configs.COLLECTORURL,a,!0))},sendEvts:function(a,b,c){if(b&&"string"===typeof a){"boolean"!==typeof c&&
(c=!0);BrowserAgent.browserUtils.getXHRforBAMetrics();var d=BrowserAgent.browserUtils.XHRToSendMetrics;d?(d.open("POST",a,c),c&&(d.onreadystatechange=function(){this.readyState===this.DONE&&(204===this.status?(BrowserAgent.logger.info("sendMetrics: Browser Agent app profile updated. Getting new app profile..."),BrowserAgent.configUtils.getAppProfile(BrowserAgent.globals.profileURL)):0===this.status&&BrowserAgent.logger.error("sendMetrics : Browser Agent Metrics Send Error. Browser is most likely discarding them."))}),
d.setRequestHeader("Content-type","application/json; charset\x3dutf-8"),b=JSON.stringify(b),!1===c&&navigator&&navigator.sendBeacon?navigator.sendBeacon(a,b):d.send(b),BrowserAgent.logger.debug("sendMetrics: Sending POST with "+b)):BrowserAgent.logger.error("sendMetrics: XHR could not be instantiated. Cannot send Browser Agent Metrics to URL: "+a+" with data as "+JSON.stringify(b))}else BrowserAgent.logger.error("sendMetrics: Cannot send Browser Agent Metrics to URL: "+a+" with data as "+JSON.stringify(b))}};
BrowserAgent.pageUtils={performance:null,init:function(){BrowserAgent.globals.initPageInfo={};BrowserAgent.globals.initPageInfo.url=window.location.href;BrowserAgent.globals.initPageInfo.timeStamp=BrowserAgent.globals.baStartTime;document.referrer&&""!==document.referrer&&(BrowserAgent.globals.initPageInfo.referrer=BrowserAgent.browserUtils.trimURL(document.referrer),BrowserAgent.globals.initPageInfo.prevPage=BrowserAgent.globals.initPageInfo.referrer);var a=BrowserAgent.jsonUtils.createBS(BrowserAgent.globals.bs,
BrowserAgent.globals.bt,BrowserAgent.globals.btc);a&&(BrowserAgent.globals.initPageInfo.businessService=a);BrowserAgent.globals.initPageInfo.pageMetricPath=BrowserAgent.globals.metricPathConsts.PREFIX+BrowserAgent.globals.pipeChar;a=BrowserAgent.browserUtils.parseURL(BrowserAgent.globals.initPageInfo.url);BrowserAgent.globals.initPageInfo.pageMetricPath=BrowserAgent.globals.bs===BrowserAgent.globals.UNDEFINED?BrowserAgent.globals.initPageInfo.pageMetricPath+(a.hostname+BrowserAgent.globals.forwardSlashChar+
a.port+BrowserAgent.globals.pipeChar+a.pathname):BrowserAgent.globals.initPageInfo.pageMetricPath+(BrowserAgent.globals.bs+BrowserAgent.globals.pipeChar+BrowserAgent.globals.bt+BrowserAgent.globals.pipeChar+BrowserAgent.globals.btc+BrowserAgent.globals.pipeChar+BrowserAgent.globals.metricPathConsts.BROWSER);""!==a.hash&&(BrowserAgent.globals.initPageInfo.pageMetricPathNoHash=BrowserAgent.globals.initPageInfo.pageMetricPath,BrowserAgent.globals.initPageInfo.pageMetricPath+=BrowserAgent.globals.pipeChar+
a.hash);BrowserAgent.pageUtils.addNewPageBucket(BrowserAgent.globals.pageBucketTypes.HP,BrowserAgent.globals.initPageInfo.url,BrowserAgent.globals.initPageInfo.timeStamp,!0,BrowserAgent.browserUtils.cloneTrackerData());BrowserAgent.globals.configs.PAGELOADMETRICSENABLED?this.performance&&this.performance.timing?(BrowserAgent.logger.info("pageUtils.init: Navigation Timing API is present."),window.addEventListener("load",BrowserAgent.pageUtils.onload,!1)):BrowserAgent.logger.warn("pageUtils.init: Navigation Timing API is not present. Page load metrics will not be reported..."):
(BrowserAgent.logger.info("pageUtils.init: Skipping page and soft page instrumentation because Page load metrics are DISABLED"),BrowserAgent.globals.isSoftPageLoad=!1);window.MutationObserver&&window.history?(BrowserAgent.globals.userAgents.EDGE.name===BrowserAgent.globals.platform||BrowserAgent.globals.userAgents.IE.name===BrowserAgent.globals.platform?window.addEventListener("hashchange",BrowserAgent.pageUtils.onpopstate,!0):window.addEventListener("popstate",BrowserAgent.pageUtils.onpopstate,!0),
BrowserAgent.globals.domChangeObserver=new MutationObserver(function(a){BrowserAgent.globals.domLastUpdated=Date.now();BrowserAgent.globals.domChangeTimerId||(document.addEventListener("mousedown",BrowserAgent.pageUtils.mouseEventHandler,!0),document.addEventListener("scroll",BrowserAgent.pageUtils.mouseEventHandler,!0),BrowserAgent.globals.domChangeTimerId=setInterval(BrowserAgent.pageUtils.checkLastDOMChange,BrowserAgent.globals.configs.DOMCHANGEINTERVAL))})):(BrowserAgent.logger.warn("pageUtils.init: HTML5 history API is not present. Soft Page load metrics will not be reported..."),
BrowserAgent.globals.isSoftPageLoad=!1)},addNewPageBucket:function(a,b,c,d,e){if(BrowserAgent.globals.configs.BROWSERAGENTENABLED){var f=BrowserAgent.globals.getSequenceNum(),g={json:{url:b,pageLoadFlag:!BrowserAgent.globals.configs.PAGELOADMETRICSENABLED,pageType:a,sessions:{sessionList:[]}},evtMap:{},evtCount:0,isExcluded:BrowserAgent.configUtils.isUrlExcluded(b)};g.isExcluded&&BrowserAgent.logger.info("addNewPageBucket: Page ["+b+"] is configured to be EXCLUDED. Skipping all instrumentation on this page...");
var h=!1;!1===d?(g.json.timeStamp=BrowserAgent.globals.currPagePtr.json.timeStamp,h=!0):(BrowserAgent.browserUtils.isSameSession(c)||(h=!0),g.json.timeStamp=c);h&&(BrowserAgent.globals.currSession=BrowserAgent.browserUtils.getNewSession(c));BrowserAgent.storageUtils.putInStorage(BrowserAgent.storageUtils.storageTypes.SESSION,BrowserAgent.storageUtils.storageKeys.BALASTEVENT_TIME,c,!0);BrowserAgent.globals.currSession.id&&(h={id:BrowserAgent.globals.currSession.id},"number"===typeof BrowserAgent.globals.currSession.startTime&&
(h.startTime=BrowserAgent.globals.currSession.startTime),"boolean"===typeof BrowserAgent.globals.currSession.isNewSession&&(h.newSessionFlag=BrowserAgent.globals.currSession.isNewSession),g.json.sessions.sessionList.push(h),BrowserAgent.globals.currSession.isNewSession&&(BrowserAgent.globals.currSession.isNewSession=!1));BrowserAgent.globals.pageBucketsMap[f]=g;BrowserAgent.globals.prevPagePtr=BrowserAgent.globals.currPagePtr;BrowserAgent.globals.currPagePtr=BrowserAgent.globals.pageBucketsMap[f];
BrowserAgent.globals.currPagePtr.id=f;a===BrowserAgent.globals.pageBucketTypes.HP?(BrowserAgent.globals.initPageInfo.id=f,BrowserAgent.globals.initPageInfo.referrer&&(g.json.referrer={url:BrowserAgent.globals.initPageInfo.referrer},g.json.prevPage={url:BrowserAgent.globals.initPageInfo.prevPage,timeStamp:BrowserAgent.globals.initPageInfo.timeStamp}),BrowserAgent.globals.initPageInfo.businessService&&(g.json.businessService=BrowserAgent.globals.initPageInfo.businessService),g.pageMetricPath=BrowserAgent.globals.initPageInfo.pageMetricPath,
!0===d&&(g.newPage=!0)):(g.json.referrer={url:BrowserAgent.globals.initPageInfo.url,timeStamp:BrowserAgent.globals.initPageInfo.timeStamp},g.json.prevPage={url:BrowserAgent.globals.prevPagePtr.json.url,timeStamp:BrowserAgent.globals.prevPagePtr.json.timeStamp},a=BrowserAgent.browserUtils.parseURL(b),BrowserAgent.globals.initPageInfo.businessService?(g.json.businessService=BrowserAgent.jsonUtils.createBS(BrowserAgent.globals.bs,BrowserAgent.globals.bt,BrowserAgent.globals.btc),g.pageMetricPath=BrowserAgent.globals.metricPathConsts.PREFIX+
BrowserAgent.globals.pipeChar+BrowserAgent.globals.bs+BrowserAgent.globals.pipeChar+BrowserAgent.globals.bt+BrowserAgent.globals.pipeChar+BrowserAgent.globals.btc+BrowserAgent.globals.pipeChar+BrowserAgent.globals.metricPathConsts.BROWSER+(""===a.hash?"":BrowserAgent.globals.pipeChar+a.hash)):g.pageMetricPath=BrowserAgent.globals.metricPathConsts.PREFIX+BrowserAgent.globals.pipeChar+a.hostname+BrowserAgent.globals.forwardSlashChar+a.port+BrowserAgent.globals.pipeChar+a.pathname+(""===a.hash?"":BrowserAgent.globals.pipeChar+
a.hash));BrowserAgent.globals.pageBucketsIdList.push(f);BrowserAgent.globals.currTTimeEvtPtr&&(BrowserAgent.globals.currTTimeEvtPtr.e=c,BrowserAgent.globals.currTTimeEvtPtr.isDone=!0);if(f=BrowserAgent.evtUtils.getEvtObject(BrowserAgent.globals.evtTypes.TTIME,!1,null))f.s=c,f[BrowserAgent.globals.trackerDataKey]=e;BrowserAgent.globals.currTTimeEvtPtr=f;BrowserAgent.globals.pageBucketsIdList.length>BrowserAgent.globals.pageBucketsMaxLen&&(c=BrowserAgent.globals.pageBucketsIdList[0],delete BrowserAgent.globals.pageBucketsMap[c],
delete BrowserAgent.globals.pageWithEventsMap[c],BrowserAgent.globals.pageBucketsIdList.shift())}},onpopstate:function(a){a=Date.now();var b=BrowserAgent.browserUtils.cloneTrackerData();BrowserAgent.pageUtils.addNewPageBucket(BrowserAgent.globals.pageBucketTypes.SP,window.location.href,a,!0,b);if(BrowserAgent.globals.domChangeTimeoutId||BrowserAgent.globals.domChangeTimerId)BrowserAgent.logger.debug("onpopstate: DOM change tracking terminated by new route change."),BrowserAgent.pageUtils.endDomTracking(a);
BrowserAgent.globals.isSoftPageLoad&&BrowserAgent.pageUtils.startDomTracking(a,b)},disableSoftPages:function(){(BrowserAgent.globals.domChangeTimeoutId||BrowserAgent.globals.domChangeTimerId)&&BrowserAgent.pageUtils.clearDomChangeTrackers();BrowserAgent.globals.isSoftPageLoad=!1},mouseEventHandler:function(){var a=Date.now();if(BrowserAgent.globals.domChangeTimeoutId||BrowserAgent.globals.domChangeTimerId)BrowserAgent.logger.debug("mouseEventHandler: DOM change tracking terminated by user interaction."),
BrowserAgent.pageUtils.endDomTracking(a)},checkLastDOMChange:function(){Date.now()>BrowserAgent.globals.domLastUpdated+BrowserAgent.globals.configs.DOMCHANGEINTERVAL&&(BrowserAgent.logger.debug("checkLastDOMChange: DOM has finished loading."),BrowserAgent.pageUtils.endDomTracking(BrowserAgent.globals.domLastUpdated))},startDomTracking:function(a,b){if(0<a){var c=BrowserAgent.evtUtils.getEvtObject(BrowserAgent.globals.evtTypes.SPLOAD,!1,null);c&&(BrowserAgent.globals.domChangeTimeoutId=setTimeout(function(){BrowserAgent.logger.debug("endDomTracking: DOM change tracking timed out.");
BrowserAgent.pageUtils.endDomTracking(Date.now())},BrowserAgent.globals.configs.DOMCHANGETIMEOUT),BrowserAgent.globals.softPageLoadEvtObj=c,c[BrowserAgent.globals.softPageDataKeys.START]=a,c[BrowserAgent.globals.trackerDataKey]=b,BrowserAgent.globals.domChangeObserver.observe(document,BrowserAgent.globals.domChangeObserverConfig))}else BrowserAgent.logger.error("startDomTracking: startTime is invalid.")},endDomTracking:function(a){if(0<a){var b=BrowserAgent.globals.domLastUpdated;BrowserAgent.pageUtils.clearDomChangeTrackers();
b||(a=BrowserAgent.globals.softPageLoadEvtObj[BrowserAgent.globals.softPageDataKeys.START]);BrowserAgent.globals.softPageLoadEvtObj[BrowserAgent.globals.softPageDataKeys.END]=a;BrowserAgent.globals.softPageLoadEvtObj.isDone=!0}else BrowserAgent.logger.error("endDomTracking: Input is invalid.")},clearDomChangeTrackers:function(){BrowserAgent.globals.domChangeObserver.disconnect();BrowserAgent.globals.domLastUpdated=null;clearInterval(BrowserAgent.globals.domChangeTimerId);BrowserAgent.globals.domChangeTimerId=
null;clearTimeout(BrowserAgent.globals.domChangeTimeoutId);BrowserAgent.globals.domChangeTimeoutId=null;document.removeEventListener("mousedown",BrowserAgent.pageUtils.mouseEventHandler,!0);document.removeEventListener("scroll",BrowserAgent.pageUtils.mouseEventHandler,!0)},onload:function(){BrowserAgent.logger.info("onload: Detected 'onload' event...");setTimeout(function(){BrowserAgent.pageUtils.onloadHelper()},0)},onloadHelper:function(){BrowserAgent.logger.info("onloadHelper: OnloadHelper has started");
var a=BrowserAgent.globals.pageBucketsMap[BrowserAgent.globals.initPageInfo.id];if(!a.isExcluded){var b=BrowserAgent.globals.getSequenceNum();a.evtMap[b]={id:b,type:BrowserAgent.globals.evtTypes.HPLOAD,raw:BrowserAgent.pageUtils.performance.timing,isDone:!0};a.evtMap[b][BrowserAgent.globals.trackerDataKey]=BrowserAgent.browserUtils.cloneTrackerData();a.evtCount+=1;BrowserAgent.globals.pageWithEventsMap[BrowserAgent.globals.initPageInfo.id]=1}},tTimeHandler:function(){if(!BrowserAgent.globals.tTimeHandlerFlag&&
BrowserAgent.globals.currTTimeEvtPtr){BrowserAgent.globals.currTTimeEvtPtr.e=Date.now();BrowserAgent.globals.currTTimeEvtPtr.isDone=!0;BrowserAgent.globals.harvestIntervalId&&(clearInterval(BrowserAgent.globals.harvestIntervalId),BrowserAgent.globals.harvestIntervalId=null);var a=JSON.parse(JSON.stringify(BrowserAgent.globals.currPagePtr.json)),b=BrowserAgent.evtUtils.handleTTimeEvt(BrowserAgent.globals.currPagePtr.pageMetricPath,a,BrowserAgent.globals.currTTimeEvtPtr);BrowserAgent.globals.tTimeHandlerFlag=
!0;b&&(BrowserAgent.jsonUtils.updateEUMWithGeo(BrowserAgent.globals.eumJSONShell),b=JSON.parse(JSON.stringify(BrowserAgent.globals.eumJSONShell)),b.app.ba.pages.pageList=[a],BrowserAgent.evtUtils.sendEvts(BrowserAgent.globals.configs.COLLECTORURL,b,!1))}}};"undefined"!==typeof BrowserAgentExtension&&(BrowserAgentExtension.extCustomPageMetricList=[],BrowserAgentExtension.extCustomJSFuncMetricList=[],BrowserAgentExtension.extCustomAjaxMetricList=[],BrowserAgentExtension.extCustomOptionalPropertyList=
[],BrowserAgentExtension.internal={createAXAEvent:function(a,b,c,d,e,f,g,h,k,l,m,n,q,s,r){var p={};"number"!==typeof a||isNaN(a)||(p.eventId=a);"string"===typeof b&&(p.eventName=b);"string"===typeof c&&(p.eventType=c);if("string"===typeof d||"number"===typeof d)p.eventValue=d.toString();"number"!==typeof e||isNaN(e)||(p.timeStamp=e);"string"===typeof f&&(p.url=f);"number"!==typeof g||isNaN(g)||(p.responseTime=g);"number"!==typeof h||isNaN(h)||(p.statusCode=h);"number"!==typeof k||isNaN(k)||(p.dataIn=
k);"number"!==typeof l||isNaN(l)||(p.dataOut=l);"string"===typeof m&&(p.countryCode=m);"string"===typeof n&&(p.zipCode=n);"string"===typeof q&&(p.latitude=q);"string"===typeof s&&(p.longitude=s);r&&0<r.length&&(p.x_attributes={x_attributeList:r});return p},addAXAData:function(a){try{if(!1!==BrowserAgent.globals.configs.BROWSERAGENTENABLED)if(null===a||"object"!==typeof a)BrowserAgent.logger.warn("BrowserAgentExtension.internal.addAXAData: Cannot add data due to invalid input");else{var b=BrowserAgent.evtUtils.getEvtObject(BrowserAgent.globals.evtTypes.AXAEXT,
!1,null);if(b){var c=[],d=[],e,f,g=JSON.parse(BrowserAgent.storageUtils.getFromStorage(BrowserAgent.storageUtils.storageTypes.SESSION,BrowserAgent.storageUtils.storageKeys.BATRKR));if("string"===typeof a.trackerId&&null!==a.trackerData&&"object"===typeof a.trackerData){if(g&&g.trackerId)return;for(e in a.trackerData)(f=BrowserAgent.jsonUtils.createXAttribute(e,a.trackerData[e]))&&c.push(f);g={};g[a.trackerId]={x_attributes:{x_attributeList:c}};BrowserAgent.storageUtils.putInStorage(BrowserAgent.storageUtils.storageTypes.SESSION,
BrowserAgent.storageUtils.storageKeys.BATRKR,JSON.stringify(g),!0)}else for(var h in g)d=d.concat(g[h].x_attributes.x_attributeList);if(a.attr)for(e in a.attr)(f=BrowserAgent.jsonUtils.createXAttribute(e,a.attr[e]))&&d.push(f);(f=BrowserAgentExtension.internal.createAXAEvent(a.eid,a.n,a.ty,a.v,a.t,a.u,a.r,a.s,a.i,a.o,a.cc,a.zp,a.la,a.lo,d))?(b.d=f,b.isDone=!0):b.isDelete=!0}}}catch(k){b&&(b.isDelete=!0)}},clearTracker:function(a){var b;try{("string"!==typeof a||1>a.length)&&BrowserAgent.logger.warn("BrowserAgentExtension.internal.clearTracker: Cannot clear data for tracker ID ["+
a+"]"),(b=JSON.parse(BrowserAgent.storageUtils.getFromStorage(BrowserAgent.storageUtils.storageTypes.SESSION,BrowserAgent.storageUtils.storageKeys.BATRKR)))&&b[a]&&(delete b[a],BrowserAgent.storageUtils.putInStorage(BrowserAgent.storageUtils.storageTypes.SESSION,BrowserAgent.storageUtils.storageKeys.BATRKR,JSON.stringify(b),!0))}catch(c){BrowserAgent.logger.error("BrowserAgentExtension.internal.clearTracker: Cannot clear data for tracker ID ["+a+"] - "+c.message)}},clearAllTrackers:function(){try{BrowserAgent.globals.isStoragePresent&&
sessionStorage.removeItem(BrowserAgent.storageUtils.storageKeys.BATRKR)}catch(a){BrowserAgent.logger.error("BrowserAgentExtension.internal.clearAllTrackers: Cannot clear tracker data - "+a.message)}},getTrackerDataById:function(a){try{var b=JSON.parse(BrowserAgent.storageUtils.getFromStorage(BrowserAgent.storageUtils.storageTypes.SESSION,BrowserAgent.storageUtils.storageKeys.BATRKR));return b&&b[a]?b[a]:null}catch(c){return BrowserAgent.logger.error("BrowserAgentExtension.internal.getTrackerDataById: Cannot obtain data for tracker ID ["+
a+"] - "+c.message),null}}},BrowserAgentExtension.createCustomMetric=function(a,b,c,d,e){return{name:a,unit:b,accumulatorType:c,value:d,path:e}},BrowserAgentExtension.addExtensionJSONObject=function(a){try{if(!1!==BrowserAgent.globals.configs.BROWSERAGENTENABLED)if(a&&0!==a.length){var b=BrowserAgent.evtUtils.getEvtObject(BrowserAgent.globals.evtTypes.APMEXT,!1,null);if(b){for(var c in a){var d=a[c];if(!d||!BrowserAgent.jsonUtils.validateMetric(d.path,d.name,d.unit,d.accumulatorType,d.value)){BrowserAgent.logger.warn("addExtensionJSONObject: Invalid metric list. Discard extension JSON object...");
b.isDelete=!0;return}}b.lst=a;b.isDone=!0}}else BrowserAgent.logger.warn("addExtensionJSONObject: Invalid metric list. Discard extension JSON object...")}catch(e){b&&(b.isDelete=!0)}},BrowserAgentExtension.addCustomOptionalProperty=function(a,b,c){BrowserAgentExtension.extCustomOptionalPropertyList.push({name:a,value:b,description:c})},BrowserAgentExtension.addCustomAjaxMetric=function(a,b,c,d){BrowserAgentExtension.extCustomAjaxMetricList.push(BrowserAgentExtension.createCustomMetric(a,b,c,d))},
BrowserAgentExtension.addCustomJSFuncMetric=function(a,b,c,d){BrowserAgentExtension.extCustomJSFuncMetricList.push(BrowserAgentExtension.createCustomMetric(a,b,c,d))},BrowserAgentExtension.addCustomPageMetric=function(a,b,c,d){BrowserAgentExtension.extCustomPageMetricList.push(BrowserAgentExtension.createCustomMetric(a,b,c,d))},BrowserAgentExtension.addJSFuncToInstrument=function(a,b,c){BrowserAgent.funcUtils.addFuncToCollection(BrowserAgent.globals.extFuncMap,a,b,c)},BrowserAgentExtension.logTextMetric=
function(a){if(a){var b={},c=a.key,d=a.value,e=a.attributes;e||(e={});e.dty="string";c&&d?(b.ty="custom",b.n=c,b.v=d,b.attr=e,b.t=(new Date).getTime(),BrowserAgentExtension.internal.addAXAData(b)):BrowserAgent.logger.warn("Event "+a+" is not valid. Please pass a valid logTextMetric event")}else BrowserAgent.logger.warn("Event "+a+" is not valid. Please pass a valid logTextMetric event")},BrowserAgentExtension.logNumericMetric=function(a){if(a){var b={},c=a.key,d=a.value,e=a.attributes;e||(e={});e.dty=
"double";c&&d?(b.ty="custom",b.n=c,b.v=d,b.attr=e,b.t=(new Date).getTime(),BrowserAgentExtension.internal.addAXAData(b)):BrowserAgent.logger.warn("Event "+a+" is not valid. Please pass a valid logNumericMetric event")}else BrowserAgent.logger.warn("Event "+a+" is not valid. Please pass a valid logNumericMetric event")},BrowserAgentExtension.setCustomerLocation=function(a){if(a){var b={},c=a.zipCode,d=a.countryCode,e=a.attributes,f=a.latitude,g=a.longitude;e||(e={});b.ty="sessionEvent";b.n="customerLocation";
var h=!1;c&&d&&(b.zp=c,b.cc=d,h=!0);f&&g&&(b.la=f,b.lo=g,c=JSON.stringify({lat:Number(f),lon:Number(g)}),BrowserAgent.storageUtils.putInStorage(BrowserAgent.storageUtils.storageTypes.SESSION,BrowserAgent.storageUtils.storageKeys.GEOCUSTOM,c,!0),h=!0);h?(b.attr=e,b.t=(new Date).getTime(),BrowserAgentExtension.internal.addAXAData(b)):BrowserAgent.logger.warn("setCustomerLocation "+a+" is not valid. Please pass a valid setCustomerLocation location")}else BrowserAgent.logger.warn("setCustomerLocation "+
a+" is not valid. Please pass a valid setCustomerLocation event")},BrowserAgentExtension.setSessionAttribute=function(a){if(a){var b={},c=a.key,d=a.value,e="string",e=a.type,f=a.attributes;f||(f={});b.ty="sessionEvent";c&&d?(b.n=c,b.v=d,b.attr=f,b.attr.dty=e,b.t=(new Date).getTime(),BrowserAgentExtension.internal.addAXAData(b)):BrowserAgent.logger.warn("Event "+a+" is not valid. Please pass a valid setSessionAttribute event")}else BrowserAgent.logger.warn("Event "+a+" is not valid. Please pass a valid setSessionAttribute event")},
BrowserAgentExtension.startApplicationTransaction=function(a){if(a){var b={},c=a.transactionName,d=a.serviceName,e=a.attributes;e||(e={});c?(a=(new Date).getTime(),b.ty="txn_events",b.n="apptxn_start",b.v=c,b.attr=e,b.attr.mode="MANUAL",b.attr.txn_s=a,e=c,b.trackerData={},d&&(b.attr.ca_as=d,b.trackerData.ca_as=d,e=c+"-"+d),BrowserAgentExtension.internal.getTrackerDataById(e)?BrowserAgent.logger.info("AXA Transaction with transaction tracker "+e+" already started"):(b.trackerId=e,b.trackerData.ca_at=
c,b.trackerData.txn_s=a,b.t=a,BrowserAgentExtension.internal.addAXAData(b))):BrowserAgent.logger.warn("Event "+a+" is not valid. Please pass a valid startApplicationTransaction  event")}else BrowserAgent.logger.warn("Event "+a+" is not valid. Please pass a valid startApplicationTransaction  event")},BrowserAgentExtension.stopApplicationTransaction=function(a){if(a){var b={},c=a.transactionName,d=a.serviceName,e="apptxn_end",f=a.failure;f&&(e="apptxn_fail");var g=a.attributes;g||(g={});c&&(a=(new Date).getTime(),
b.ty="txn_events",b.n=e,b.v=c,b.attr=g,b.attr.mode="MANUAL",f&&(b.attr.fd=f),e=c,d&&(b.attr.ca_as=d,e=c+"-"+d),b.t=a,c=e,(c=BrowserAgentExtension.internal.getTrackerDataById(e))?(BrowserAgentExtension.internal.addAXAData(b),BrowserAgentExtension.internal.clearTracker(e)):BrowserAgent.logger.info("Cannot stop AXA Transaction with transaction tracker "+c+". Please check if transaction is started"))}else BrowserAgent.logger.warn("Event "+a+" is not valid. Please pass a valid stopApplicationTransaction event")},
BrowserAgentExtension.logNetworkEvent=function(a){if(a){var b={};b.u=a.url;b.s=a.status;b.i=a.inbytes;b.o=a.outbytes;b.r=a.time;var c=a.attributes;c||(c={});b.u&&b.s&&b.i&&b.o&&b.r?(b.ty="network",b.attr=c,b.t=(new Date).getTime(),BrowserAgentExtension.internal.addAXAData(b)):BrowserAgent.logger.warn("Event "+a+" is not valid. Please pass a valid network event with url,in bytes , out bytes , status and response time")}else BrowserAgent.logger.warn("Event "+a+" is not valid. Please pass a valid logNetworkEvent event")},
BrowserAgentExtension.setCustomerId=function(a){if(a){var b={};if(a.customerId){var c=a.customerId,d=a.attributes;d||(d={});b.ty="sessionEvent";c?(b.n="customerId",b.v=c,b.attr=d,b.t=(new Date).getTime(),BrowserAgentExtension.internal.addAXAData(b)):BrowserAgent.logger.warn("Event "+a+" is not valid. Please pass a valid setCustomerId event")}else BrowserAgent.logger.warn("Event "+a+" is not valid. Please pass a valid customerId in event")}else BrowserAgent.logger.warn("Event "+a+" is not valid. Please pass a valid setCustomerId event")});
BrowserAgent.main=function(){Date.now||(Date.now=function(){return(new Date).getTime()});String.prototype.includes||(String.prototype.includes=BrowserAgent.browserUtils.includes);BrowserAgent.globals.configs=JSON.parse(JSON.stringify(BrowserAgent.configUtils.defaults));BrowserAgent.globals.configs.BROWSERLOGGINGENABLED=!0;BrowserAgent.pageUtils.performance=window.performance;BrowserAgent.globals.baStartTime=BrowserAgent.pageUtils.performance&&BrowserAgent.pageUtils.performance.timing&&BrowserAgent.pageUtils.performance.timing.navigationStart?
BrowserAgent.pageUtils.performance.timing.navigationStart:Date.now();var a=BrowserAgent.cookieUtils.getRawCookie(BrowserAgent.cookieUtils.cookies.PLATFORM);if(a){if(a===BrowserAgent.globals.userAgents.UNSUPPORTED.name){BrowserAgent.logger.warn("BrowserAgent.main: Unsupported browser. Disabling Browser Agent ...");return}}else if(a=BrowserAgent.browserUtils.getBrowserInfo(navigator.userAgent),BrowserAgent.cookieUtils.setRawCookie(BrowserAgent.cookieUtils.cookies.PLATFORM,a.name,null,"/",null),BrowserAgent.cookieUtils.setRawCookie(BrowserAgent.cookieUtils.cookies.PLATFORMVER,
a.ver,null,"/",null),!a.isSupported){BrowserAgent.logger.warn("BrowserAgent.main: Unsupported browser. Disabling Browser Agent ...");return}if(a=BrowserAgent.cookieUtils.getRawCookie(BrowserAgent.cookieUtils.cookies.SERVERTIME))BrowserAgent.globals.gapTimeInMillis=BrowserAgent.globals.baStartTime-a,BrowserAgent.cookieUtils.setRawCookie(BrowserAgent.cookieUtils.cookies.GAPTIME,Math.ceil(BrowserAgent.globals.gapTimeInMillis/1E3),null,"/",null),BrowserAgent.logger.info("BrowserAgent.main: Client Server gap time is "+
BrowserAgent.globals.gapTimeInMillis+" ms");if(BrowserAgent.configUtils.extractAppInfo()){var b=new XMLHttpRequest;b&&(b.open("GET",BrowserAgent.globals.profileURL,!1),b.onreadystatechange=function(){if(b.readyState===this.DONE&&200===b.status){var a=null;try{a=JSON.parse(b.responseText)}catch(d){BrowserAgent.logger.error("BrowserAgent.main: Invalid app profile - "+d.message+". Disabling Browser Agent...");return}BrowserAgent.configUtils.processAppProfile(a)&&(!1===BrowserAgent.globals.configs.BROWSERAGENTENABLED?
BrowserAgent.logger.info("BrowserAgent.main: Browser Agent is DISABLED."):"string"!==typeof BrowserAgent.globals.configs.COLLECTORURL||""===BrowserAgent.globals.configs.COLLECTORURL?BrowserAgent.logger.error("BrowserAgent.main: Invalid collector URL. Disabling Browser Agent..."):(BrowserAgent.cookieUtils.init(),BrowserAgent.storageUtils.init(),BrowserAgent.browserUtils.init(),BrowserAgent.funcUtils.init(),BrowserAgent.errorUtils.init(),BrowserAgent.evtUtils.init(),BrowserAgent.globals.init(),window.addEventListener("beforeunload",
BrowserAgent.pageUtils.tTimeHandler,!0),window.addEventListener("pagehide",BrowserAgent.pageUtils.tTimeHandler,!0),BrowserAgent.pageUtils.init(),"undefined"!==typeof BrowserAgentExtension&&BrowserAgentExtension.init(),BrowserAgent.globals.harvestIntervalId=setInterval(BrowserAgent.evtUtils.harvestEvts,BrowserAgent.globals.configs.METRICFREQUENCY)))}},b.send())}else BrowserAgent.logger.warn("BrowserAgent.main: Disabling Browser Agent ...")};"prerender"===document.visibilityState&&BrowserAgent.logger.warn("Web page in pre-render state.");
BrowserAgent.main()}catch(e$$34){window.console&&"object"===typeof window.console&&window.console.log(new Date+" [CA Browser Agent]: [ERROR] "+e$$34.message)};